(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9401],{68242:function(e,t,n){/*! For license information please see index.js.LICENSE.txt */!function(){"use strict";var t={n:function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,{a:n}),n},d:function(e,n){for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};t.r(r),t.d(r,{AuthorizationError:function(){return t5},CaptureEventType:function(){return t9},ErrorSource:function(){return t8},ErrorType:function(){return t6},LogLevel:function(){return t7},MediaPlayer:function(){return t4},MetadataEventType:function(){return eh},MetadataID3Type:function(){return ef},PlayerEventType:function(){return x},PlayerState:function(){return ep},RemotePlayerEvent:function(){return ev},create:function(){return tU},createWorker:function(){return tO},getVersion:function(){return tB},isPlayerSupported:function(){return tF},isVP9Supported:function(){return B},isWasmSupported:function(){return tN},registerIVSQualityPlugin:function(){return no},registerIVSTech:function(){return ni}});var i=n(62725),a=n(97480),o=t.n(a),s=function(){function e(){this.buffer=void 0,this.head=void 0,this.tail=void 0,this.buffer=[],this.head=0,this.tail=0}var t=e.prototype;return t.push=function(e){this.tail===this.buffer.length?this.buffer.push(e):this.buffer[this.tail]=e,this.tail++},t.pop=function(){var e,t=null!=(e=this.buffer[this.head])?e:null;return this.buffer[this.head]=null,this.head++,this.empty()&&(this.head=0,this.tail=0),t},t.size=function(){return this.tail-this.head},t.empty=function(){return this.head>=this.tail},e}();function u(e){try{return JSON.parse(e)}catch(t){return console.error("Failed JSON parse:",e),{}}}function c(e){return""===e.codecs||"undefined"==typeof MediaSource||MediaSource.isTypeSupported('video/mp4;codecs="'+e.codecs+'"')}function d(e){var t,n;return void 0!==e.hidden?(t="hidden",n="visibilitychange"):void 0!==e.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==e.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),{hidden:t,visibilityChange:n}}function l(e,t,n){return Math.min(n,Math.max(t,e))}function h(e){e.removeAttribute("src")}function f(e){if("function"==typeof e.checkVisibility)return e.checkVisibility({visibilityProperty:!0});var t=e.style;return"none"!==t.display&&"hidden"!==t.visibility}var v={audio:1936684398,video:1986618469};function p(e){return"number"==typeof e.webkitDecodedFrameCount?e.webkitDecodedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().totalVideoFrames:"number"==typeof e.mozDecodedFrames?e.mozDecodedFrames:0}function m(e){return"number"==typeof e.webkitDroppedFrameCount?e.webkitDroppedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().droppedVideoFrames:0}function g(e,t){for(var n=0;n<t.length;n++)console.info(e,"start: ",t.start(n),", end: ",t.end(n))}function y(e,t,n){for(var r=0;r<e.length;r++){var i=e.start(r),a=e.end(r);if(!(a<=t)){if(i-n>t)break;for(var o=r+1;o<e.length&&!(e.start(o)-a>n);o++)a=e.end(o);for(var s=r-1;s>=0&&!(i-e.end(s)>n);s--)i=e.start(s);return{start:Math.min(i,t),end:a}}}return{start:t,end:t}}function S(e,t,n){void 0===n&&(n=.1);var r=y(e,t,n).end-t>n;if(e.length>1||!r)for(var i=0;i<e.length;i++){var a=e.start(i),o=e.end(i);if(t<a&&o-a>n)return a+n}return r?t+n:t}function k(e,t,n){return e.addEventListener(t,n),function(){e.removeEventListener(t,n)}}function b(e){if(e.src){var t=e.src;h(e),e.load(),URL.revokeObjectURL(t)}}function E(e){var t=(e||"").match(/codecs="([^.]+)\./);return t&&t[1]?t[1]:""}var C=function(){function e(e,t,n,r,i){this.rawCodec=t,this.group=n,this.isProtected=r,this.onError=i,this.pending=void 0,this.unsubscribers=[],this.srcBuf=void 0,this.blocked=!1,this.srcBuf=e,this.pending=new s,this.unsubscribers.push(k(e,"updateend",this.process.bind(this)))}var t=e.prototype;return t.getBufferedRanges=function(){try{var e=[];if(this.srcBuf)for(var t=this.srcBuf.buffered,n=0;n<t.length;n++)e.push({start:t.start(n),end:t.end(n)});return e}catch(e){return[]}},t.abort=function(){this.schedule(function(e){e.abort()})},t.changeType=function(e){var t;this.rawCodec=(t=(e||"").match(/codecs=".+"/))&&t[0]?t[0]:'codecs=""',this.schedule(function(t){t.changeType(e)})},t.appendBuffer=function(e){this.schedule(function(t){try{t.appendBuffer(e)}catch(e){if("QuotaExceededError"!==e.name)throw e;var n=t.buffered,r=n.start(0),i=n.end(n.length-1);t.remove((r+i)/2,i)}})},t.setTimestampOffset=function(e){this.schedule(function(t){t.timestampOffset=e})},t.remove=function(e,t){this.schedule(function(n){var r=n.buffered;if(r.length){var i=Math.max(e,r.start(0)),a=Math.min(t,r.end(r.length-1));i<a&&n.remove(i,a)}})},t.block=function(){var e=this;return new Promise(function(t){e.schedule(function(){e.blocked=!0,t()})})},t.unblock=function(){this.blocked=!1,this.process()},t.destroy=function(){this.pending=new s,this.unsubscribers.forEach(function(e){return e()}),this.srcBuf=void 0},t.schedule=function(e){this.pending.empty()&&this.canProcess()?this.safeExecute(e):(this.pending.push(e),this.process())},t.safeExecute=function(e){try{if(!this.srcBuf)throw Error("srcBuf is undefined");e(this.srcBuf)}catch(e){this.onError(e,!1)}},t.process=function(){for(;!this.pending.empty()&&this.canProcess();)this.safeExecute(this.pending.pop())},t.canProcess=function(){return!(!this.srcBuf||this.srcBuf.updating||this.blocked)},o()(e,[{key:"buffer",get:function(){return this.srcBuf}},{key:"codec",get:function(){return this.rawCodec}},{key:"timestampOffset",get:function(){return this.buffer?this.buffer.timestampOffset:0}}])}(),T=function(){function e(e,t,n){this.mediaSource=e,this.onEnded=t,this.onError=n,this.sourceBuffers=Object.create(null),this.unsubscribers=[],this.unsubscribers.push(k(e,"sourceended",this.onEnded))}e.isSupported=function(){return void 0!==self.MediaSource},e.isSupportedInWorker=function(){return e.isSupported()&&MediaSource.canConstructInDedicatedWorker&&"function"==typeof MediaSourceHandle},e.create=function(t,n){var r=new MediaSource,i=new Promise(function(i,a){var o=k(r,"sourceopen",function(){"open"===r.readyState?(i(new e(r,t,n)),o()):a("The MediaSource was closed upon opening")})});return{ms:r,sink:i}};var t=e.prototype;return t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.sourceBuffers[v[e]])?void 0:n.getBufferedRanges())?t:[]},t.addTrack=function(e,t,n,r){var i=this.mediaSource,a=this.sourceBuffers,o="video/mp4;"+t;if(a[e]){var s,u=E(a[e].codec);return E(t)!==u&&a[e].changeType(o),null!=(s=a[e].buffer)?s:null}try{var c=i.addSourceBuffer(o);return a[e]=new C(c,t,n,r,this.handleError.bind(this)),c}catch(e){this.handleError(e,"open"===i.readyState)}return null},t.append=function(e,t){var n;null==(n=this.sourceBuffers[e])||n.appendBuffer(t)},t.remove=function(e,t){for(var n=this.sourceBuffers,r=0,i=Object.keys(n);r<i.length;r++)n[i[r]].remove(e,t)},t.setTimestampOffset=function(e,t){var n=this.sourceBuffers[e];n&&(n.abort(),n.setTimestampOffset(t))},t.setDuration=function(e){var t=this;this.scheduleUpdate(function(){return t.mediaSource.duration=e}).catch(function(e){return t.handleError(e,!1)})},t.setLiveSeekableRange=function(e,t){var n=this;this.scheduleUpdate(function(){return n.mediaSource.setLiveSeekableRange(e,t)}).catch(function(e){return n.handleError(e,!1)})},t.scheduleUpdate=function(e){var t=this;void 0===e&&(e=P);var n=Object.keys(this.sourceBuffers).map(function(e){return t.sourceBuffers[e]});return Promise.all(n.map(function(e){return e.block()})).then(e).then(function(){return n.forEach(function(e){return e.unblock()})})},t.isDrmProtected=function(){return this.bufferProperties.some(function(e){return e.isProtected})},t.isAudioOnly=function(){return 1===this.bufferProperties.length&&"audio_only"===this.bufferProperties[0].group},t.destroy=function(){this.destroySourceBuffers(),this.unsubscribers.forEach(function(e){return e()}),this.unsubscribers=[]},t.handleError=function(e,t){var n=e.code||102,r=102;"NotSupportedError"===e.name&&(r=n=4),this.onError(r,n,e.message,t)},t.destroySourceBuffers=function(){for(var e=this.mediaSource;e.sourceBuffers.length>0;)try{e.removeSourceBuffer(e.sourceBuffers[0])}catch(e){this.handleError(e,!1);break}for(var t=0,n=Object.keys(this.sourceBuffers);t<n.length;t++){var r=n[t];this.sourceBuffers[r].destroy()}this.sourceBuffers=Object.create(null)},o()(e,[{key:"duration",get:function(){return this.mediaSource.duration}},{key:"bufferProperties",get:function(){var e=this.sourceBuffers;return Object.keys(e).map(function(t){var n=e[t];return{trackID:Number(t),codec:n.codec,mode:"mse",path:"",isProtected:n.isProtected,group:n.group,srcObj:null}})}}])}(),P=function(){},w=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/,A=/^(\d+)\.(\d+)[+|-]?(.*)?$/,D=/^(\d+)$/,M={chrome:!1,chromecast:!1,domain:"",electron:!1,family:"",firefox:!1,host:"",major:-1,minor:-1,msEdgeLegacy:!1,msEdgeChromium:!1,msIE:!1,name:"",opera:!1,osName:"",osVersion:"",patch:-1,safari:!1,url:"",userAgent:"",mobile:!1,supportsDataChannels:!1,supportsWebTransport:!1,supportsMSEInWorkers:!1},L=null;function _(){if(L)return L;if("undefined"==typeof window||"undefined"==typeof navigator)return L=M;var e,t,n=i.getParser(navigator.userAgent),r=(e=String(n.getBrowserVersion()),{major:parseInt((t=w.exec(e)||A.exec(e)||D.exec(e)||[])[1],10)||0,minor:parseInt(t[2],10)||0,patch:parseInt(t[3],10)||0}),a=n.getEngine();return L={chrome:!!n.some(["chrome"]),chromecast:navigator.userAgent.toLowerCase().indexOf("crkey")>-1,domain:window.location.host.split(".").slice(-2).join("."),electron:!!n.some(["electron"]),family:n.getBrowserName().toLowerCase(),firefox:!!n.some(["firefox"]),host:window.location.host,major:r.major,minor:r.minor,msEdgeLegacy:!!n.some(["microsoft edge"])&&"Blink"!==a.name,msEdgeChromium:!!n.some(["microsoft edge"])&&"Blink"===a.name,msIE:!!n.some(["internet explorer"]),name:navigator.appVersion,opera:!!n.some(["opera"]),osName:n.getOSName(),osVersion:String(n.getOSVersion()),patch:r.patch,safari:!!n.some(["safari"]),url:window.location.href,userAgent:navigator.userAgent,mobile:!(!n.some(["mobile"])&&!n.some(["tablet"])),supportsDataChannels:"RTCPeerConnection"in window,supportsWebTransport:"WebTransport"in window,supportsMSEInWorkers:T.isSupportedInWorker()}}var R=n(57311),I=t.n(R),x=((ez={}).INITIALIZED="PlayerInitialized",ez.QUALITY_CHANGED="PlayerQualityChanged",ez.DURATION_CHANGED="PlayerDurationChanged",ez.VOLUME_CHANGED="PlayerVolumeChanged",ez.MUTED_CHANGED="PlayerMutedChanged",ez.PLAYBACK_RATE_CHANGED="PlayerPlaybackRateChanged",ez.REBUFFERING="PlayerRebuffering",ez.AUDIO_BLOCKED="PlayerAudioBlocked",ez.PLAYBACK_BLOCKED="PlayerPlaybackBlocked",ez.ERROR="PlayerError",ez.RECOVERABLE_ERROR="PlayerRecoverableError",ez.ANALYTICS_EVENT="PlayerAnalyticsEvent",ez.TIME_UPDATE="PlayerTimeUpdate",ez.SYNC_TIME_UPDATE="PlayerSyncTimeUpdate",ez.BUFFER_UPDATE="PlayerBufferUpdate",ez.SEEK_COMPLETED="PlayerSeekCompleted",ez.SESSION_DATA="PlayerSessionData",ez.STATE_CHANGED="PlayerStateChanged",ez.WORKER_ERROR="PlayerWorkerError",ez.METADATA="PlayerMetadata",ez.TEXT_CUE="PlayerTextCue",ez.TEXT_METADATA_CUE="PlayerTextMetadataCue",ez.AD_CUE="PlayerAdCue",ez.STREAM_SOURCE_CUE="PlayerStreamSourceCue",ez.NETWORK_UNAVAILABLE="PlayerNetworkUnavailable",ez.SEGMENT_DISCONTINUITY="PlayerSegmentDiscontinuity",ez.SEGMENT_METADATA="PlayerSegmentMetadata",ez),V=null,O=null;function N(e){var t=e.type===x.ANALYTICS_EVENT,n=e.arg&&"video_error"===e.arg.name;if(t&&n){if(!V&&!O){var r=document.createElement("canvas");try{var i=r.getContext("webgl")||r.getContext("experimental-webgl");if(i&&"getExtension"in i){var a=i.getExtension("WEBGL_debug_renderer_info");a&&"getParameter"in i&&(V=i.getParameter(a.UNMASKED_RENDERER_WEBGL),O=i.getParameter(a.UNMASKED_VENDOR_WEBGL))}}catch(e){}}e.arg.properties.gl_renderer=V,e.arg.properties.gl_vendor=O}return e}var F=function(){function e(){var t=this;this.batteryManager=void 0,this.processor=this.processor.bind(this),e.isSupported()&&window.navigator.getBattery().then(function(e){t.batteryManager=e})}return e.isSupported=function(){var e;return void 0!==(null==(e=window)||null==(e=e.navigator)?void 0:e.getBattery)},e.prototype.processor=function(e){var t=e.type===x.ANALYTICS_EVENT,n=e.arg&&"minute-watched"===e.arg.name;return t&&n&&this.batteryManager&&(e.arg.properties.battery_percent=this.batteryManager.level),e},e}();function U(){return"undefined"!=typeof MediaSource}function B(){var e=_();return"Windows"===e.osName&&(e.chrome||e.firefox||e.msEdgeChromium)&&U()?"mediaCapabilities"in navigator?navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:'video/mp4;codecs="vp09.00.41.08"',width:1920,height:1080,bitrate:8e6,framerate:60}}).then(function(e){return e.supported&&e.smooth}):Promise.resolve(MediaSource.isTypeSupported('video/mp4;codecs="vp09.00.10.08"')):Promise.resolve(!1)}var H={keySystem:"org.w3.clearkey",uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b"},G={keySystem:"com.apple.fps.2_0",certUrl:"https://fp-keyos-twitch.licensekeyserver.com/cert/a17fd33d3843df9b17679ccf50a419b2.der",licenseUrl:"https://fp-keyos-twitch.licensekeyserver.com/getkey",uuid:"94CE86FB-07FF-4F43-ADB8-93D2FA968CA2"},W={keySystem:"com.microsoft.playready",licenseUrl:"https://pr-keyos-twitch.licensekeyserver.com/core/rightsmanager.asmx",uuid:"9a04f079-9840-4286-ab92-e65be0885f95"},j={keySystem:"com.widevine.alpha",licenseUrl:"https://wv-keyos-twitch.licensekeyserver.com",uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"},q={CLEARKEY:H,FAIRPLAY:G,PLAYREADY:W,WIDEVINE:j},K={"com.widevine.alpha":j,"com.microsoft.playready":W,"com.apple.fps.2_0":G,"org.w3.clearkey":H},Q={value:4,message:"Your browser does not support any DRM Content Decryption Modules"},Y={value:4,message:"There was an issue while updating DRM License"},X={value:204,message:"Error while requesting DRM license"},z={value:201,message:"DRM license not authorized for this browser version"},J={value:202,message:"DRM license not available"},Z={value:203,message:"DRM license server error"},$={value:4,message:"Error creating key session"},ee={value:4,message:"Encryption key not usable because of internal error in CDM"},et={value:4,message:"Unable to find valid CDM support on media"},en={value:2,message:"Request for AuthXML failed"},er={value:2,message:"Request for DRM certificate failed"};function ei(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ea(e){return e instanceof Uint8Array||e instanceof Uint16Array?e.buffer:e}function eo(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;for(var a in i.open(t.method,e,!0),t.headers)Object.prototype.hasOwnProperty.call(t.headers,a)&&i.setRequestHeader(a,t.headers[a]);i.responseType=t.responseType,i.onload=function(){200===i.status&&n(i.response)},i.onloadend=function(){r(i.status)},i.send(t.body)})}function es(e,t){for(var n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=eu(t),i=0;i<e.byteLength;){var a=n.getUint32(i);if(n.getUint32(i+4)===r)return e.subarray(i+8,i+a);i+=a}return new Uint8Array(e)}function eu(e){return(e.charCodeAt(0)<<24)+(e.charCodeAt(1)<<16)+(e.charCodeAt(2)<<8)+e.charCodeAt(3)}function ec(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function ed(e){for(var t=atob(e),n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r}function el(e){return decodeURIComponent(e.replace(/\+/g," "))}var eh=((eJ={}).ID3="MetaID3",eJ.CAPTION="MetaCaption",eJ),ef=((eZ={}).METADATA_ID="metadata.live-video.net",eZ.INBAND_METADATA_ID="inband.metadata.live-video.net",eZ),ev=((e$={}).AVAILABLE="RemotePlayerAvailable",e$.UNAVAILABLE="RemotePlayerUnavailable",e$.SESSION_STARTED="RemotePlayerSessionStarted",e$.SESSION_ENDED="RemotePlayerSessionEnded",e$),ep=((e0={}).IDLE="Idle",e0.READY="Ready",e0.BUFFERING="Buffering",e0.PLAYING="Playing",e0.ENDED="Ended",e0),em=n(21893),eg=t.n(em),ey=n(92118),eS=t.n(ey);function ek(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var eb=[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{robustness:"SW_SECURE_CRYPTO",contentType:'video/mp4;codecs="avc1.42E01E"'}]}],eE=function(){function e(e){var t=this;this.video=void 0,this.listener=void 0,this.cdmSupport=void 0,this.selectedCDM=void 0,this.mediaKeys=void 0,this.pendingSessions=void 0,this.sessions=void 0,this.authXml=void 0,this.video=e.video,this.listener=e.listener,this.cdmSupport=null,this.selectedCDM=null,this.mediaKeys=void 0,this.pendingSessions=[],this.reset(),this.video.addEventListener("encrypted",function(e){return t.handleEncrypted(e)}),this.video.addEventListener("webkitneedkey",function(e){return t.handleWebKitEncrypted(e)})}var t,n,r,i,a,o=e.prototype;return o.configure=function(e){var t=this;if(!this.authXml){var n,r,i=new URL(e),a=i.pathname.split("/"),o=a[a.length-1].split(".")[0],s=(n=new URL(e).searchParams,r={},n.forEach(function(e,t){r[el(t)]=e?el(e):""}),r),u=s.token,c=s.sig,d="https://"+i.host+"/api/authxml/"+o+"?token="+encodeURIComponent(u)+"&sig="+c;this.authXml=eo(d,{method:"GET",responseType:"text"}).catch(function(e){t.handleError(Object.assign({code:e},en))})}},o.reset=function(){this.authXml=null,this.sessions=[]},o.isProtected=function(){return null!==this.authXml},o.handleError=function(e){this.listener.onSinkError({value:e.value||4,code:e.code||0,message:e.message||""})},o.hasSession=function(e){if(!e)return!1;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ek(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ek(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.sessions);!(t=n()).done;){var r=t.value;if(r.initData&&function(e,t){if((e=ea(e))===(t=ea(t)))return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<n.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}(r.initData,e))return!0}return!1},o.createKeySystemSupportChain=function(){if(null===this.cdmSupport||0===this.cdmSupport.length)return Promise.reject(et);var e=Promise.reject();return this.cdmSupport.forEach(function(t){e=e.catch(function(){return navigator.requestMediaKeySystemAccess(t.keySystem,eb)})}),e=e.catch(function(){return Promise.reject(Q)})},o.handleEncrypted=(t=eg()(eS().mark(function e(t){var n,r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasSession(t.initData)){e.next=2;break}return e.abrupt("return");case 2:if(this.sessions.push(t),"sinf"!==t.initDataType){e.next=6;break}return this.handleWebKitEncrypted(t),e.abrupt("return");case 6:if(null===this.cdmSupport&&(this.cdmSupport=function(e){var t,n;return t=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),n=[],r=0;!(r>=t.buffer.byteLength);){var i=r+t.getUint32(r);if(r+=4,t.getUint32(r)===eu("pssh")){r+=4;var a=t.getUint8(r);if(0===a||1===a){r++,r+=3;for(var o="",s=0;s<4;s++)o+=ec(t.getUint8(r+s));r+=4,o+="-";for(var u=0;u<2;u++)o+=ec(t.getUint8(r+u));r+=2,o+="-";for(var c=0;c<2;c++)o+=ec(t.getUint8(r+c));r+=2,o+="-";for(var d=0;d<2;d++)o+=ec(t.getUint8(r+d));r+=2,o+="-";for(var l=0;l<6;l++)o+=ec(t.getUint8(r+l));r+=6,o=o.toLowerCase(),r+=4,n.push(o),r=i}else r=i}else r=i}return n}(e),n=[],t.forEach(function(e){Object.keys(q).forEach(function(t){var r=q[t];r.uuid.toLowerCase()===e.toLowerCase()&&n.push(r)})}),n}(t.initData)),void 0!==this.mediaKeys){e.next=24;break}return this.mediaKeys=null,e.prev=9,e.next=12,this.createKeySystemSupportChain();case 12:return n=e.sent,this.selectedCDM=K[n.keySystem],e.next=16,n.createMediaKeys();case 16:return r=e.sent,e.next=19,this.setMediaKeys(r);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),this.handleError(e.t0);case 24:this.addSession(t);case 25:case"end":return e.stop()}},e,this,[[9,21]])})),function(e){return t.apply(this,arguments)}),o.setMediaKeys=function(e){var t=this;return this.mediaKeys=e,this.pendingSessions.forEach(function(e){return t.createSessionRequest(e).catch(function(){t.handleError($)})}),this.pendingSessions=[],this.video.setMediaKeys(this.mediaKeys)},o.addSession=function(e){var t=this;this.mediaKeys?this.createSessionRequest(e).catch(function(){t.handleError($)}):this.pendingSessions.push(e)},o.createSessionRequest=function(e){var t,n=this,r=e.initDataType,i=e.initData,a=null==(t=this.mediaKeys)?void 0:t.createSession();return a?(a.addEventListener("message",function(e){return n.handleMessage(e)}),a.addEventListener("keystatuseschange",function(e){return n.handleKeyStatusesChange(e,i)}),a.generateRequest(r,i)):Promise.reject()},o.handleKeyStatusesChange=function(e,t){var n=this,r=e.target,i=!1;r.keyStatuses.forEach(function(e){switch(e){case"expired":i=!0;break;case"internal-error":n.handleError(ee)}}),i&&r.close().then(function(){return n.removeSession(t)})},o.removeSession=function(e){for(var t=0;t<this.sessions.length;t++)if(this.sessions[t].initData===e)return void this.sessions.splice(t,1)},o.handleMessage=(n=eg()(eS().mark(function e(t){var n,r,i=this;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.next=3,this.generateLicense(t.message);case 3:(r=e.sent)&&n.update(r).catch(function(){i.handleError(Y)});case 5:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),o.generateLicense=(r=eg()(eS().mark(function e(t){var n,r,i;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.selectedCDM!==q.CLEARKEY){e.next=5;break}return n=JSON.parse((new TextDecoder).decode(t)).kids.map(function(e){return{kty:"oct",alg:"A128KW",kid:e,k:e}}),r=(new TextEncoder).encode(JSON.stringify({keys:n})),e.abrupt("return",Promise.resolve(r));case 5:if(!this.authXml){e.next=10;break}return e.next=8,this.authXml;case 8:return i=e.sent,e.abrupt("return",this.requestLicense(t,i));case 10:this.handleError(en);case 11:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),o.requestLicense=(i=eg()(eS().mark(function e(t,n){var r,i,a,o=this;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"POST",responseType:"arraybuffer",body:t,headers:{customdata:n,"Content-Type":"application/octet-stream"}},this.selectedCDM===q.PLAYREADY&&(a=function(e){var t,n,r=String.fromCharCode.apply(null,new Uint16Array(e)),i=(new DOMParser).parseFromString(r,"application/xml");return{headers:Array.from(i.querySelectorAll("HttpHeader")).reduce(function(e,t){var n,r,i=null==(n=t.querySelector("name"))?void 0:n.textContent,a=null==(r=t.querySelector("value"))?void 0:r.textContent;return i&&a&&(e[i]=a),e},{}),body:(n=null==(t=i.querySelector("Challenge"))?void 0:t.textContent)?atob(n):""}}(t),i.body=a.body,i.headers=Object.assign(i.headers,a.headers)),e.abrupt("return",eo((null==(r=this.selectedCDM)?void 0:r.licenseUrl)||"",i).catch(function(e){var t;switch(e){case 0:t=X;break;case 404:t=J;break;case 403:t=z;break;default:t=Z}o.handleError(Object.assign({code:e},t))}));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)}),o.handleWebKitEncrypted=(a=eg()(eS().mark(function e(t){var n,r=this;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.selectedCDM=q.FAIRPLAY,e.prev=1,e.next=4,eo(q.FAIRPLAY.certUrl||"",{method:"GET",responseType:"arraybuffer",headers:{Pragma:"Cache-Control: no-cache","Cache-Control":"max-age=0"}});case 4:n=e.sent,this.setupWebKitMediaKeys(t,n).catch(function(e){return r.handleError(e)}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.handleError(Object.assign({code:e.t0},er));case 11:case"end":return e.stop()}},e,this,[[1,8]])})),function(e){return a.apply(this,arguments)}),o.setupWebKitMediaKeys=function(e,t){var n,r,i=this;if(!e.initData)return Promise.reject("Missing initData on MediaEncryptedEvent");this.video.webkitKeys||this.video.webkitSetMediaKeys(new window.WebKitMediaKeys(q.FAIRPLAY.keySystem));var a=(n=e.initData,r=es(ed(JSON.parse(String.fromCharCode.apply(null,n)).sinf[0]),"schi"),function(e){for(var t,n="",r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ei(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ei(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(t=r()).done;)n+=ec(t.value);return n}(es(r,"tenc").subarray(8,24))),o=this.video.webkitKeys.createSession("video/mp4",e.initData);return o.contentId=a,new Promise(function(e,n){if(i.video.webkitKeys||n("Issue setting fairplay media keys"),!o)return n("Could not create key session");o.addEventListener("webkitkeymessage",function(e){var r=e.target;"certificate"===String.fromCharCode.apply(null,e.message)?r.update(new Uint8Array(t)):i.getWebkitLicense(e.message,a).then(function(e){var t=e.trim();"<ckc>"===t.substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6)),r.update(ed(t))}).catch(n)}),o.addEventListener("webkitkeyadded",e),o.addEventListener("webkitkeyerror",n)})},o.getWebkitLicense=function(e,t){return this.authXml?this.authXml.then(function(n){return eo(q.FAIRPLAY.licenseUrl||"",{method:"POST",body:"spc="+btoa(String.fromCharCode.apply(null,new Uint16Array(e)))+"&assetId="+t,responseType:"text",headers:{"Content-Type":"application/x-www-form-urlencoded",customdata:n}}).catch(function(e){return Promise.reject(Object.assign({code:e},X))})}):Promise.reject(en)},e}(),eC=n(85552),eT=t.n(eC),eP=function(){function e(){}var t=e.prototype;return t.addTrack=function(e){},t.bufferDuration=function(){return 0},t.buffered=function(){return{start:0,end:0}},t.getBufferedRanges=function(e){return[]},t.captureGesture=function(){},t.configure=function(e){},t.delete=function(){},t.endOfStream=function(){},t.enqueue=function(e){},t.getCurrentTime=function(){return 0},t.getPlaybackRate=function(){return 0},t.getVolume=function(){return 0},t.invoke=function(e){this[e.name].call(this,e.arg)},t.isMuted=function(){return!1},t.onSourceDurationChanged=function(e){},t.pause=function(){},t.play=function(){},t.reinit=function(){},t.remove=function(e){},t.seekTo=function(e){},t.setMuted=function(e){},t.setPlaybackRate=function(e){},t.setTimestampOffset=function(e){},t.setVolume=function(e){},t.changeSrc=function(e){},t.changeSrcObj=function(e){},t.onSegmentDiscontinuity=function(){},e}(),ew="pc-chromecast-sender",eA=function(e){function n(t){var r;return(r=e.call(this)||this).remotePlayer=void 0,r.remotePlayerController=void 0,r.listener=void 0,r.seekTime=void 0,r.currentDuration=void 0,r.listener=t,r.currentDuration=0,n.prepareCastContext().then(function(){r.remotePlayer=new cast.framework.RemotePlayer,r.remotePlayerController=new cast.framework.RemotePlayerController(r.remotePlayer)}).catch(function(){r.listener.onSessionError()}),r}eT()(n,e),n.canCast=function(){return _().chrome},n.stopLookingForRemotePlaybackDevices=function(e){window.cast&&window.cast.framework&&cast.framework.CastContext.getInstance().removeEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,e)},n.lookForRemotePlaybackDevices=(r=eg()(eS().mark(function e(t){var r,i;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.prepareCastContext();case 3:return r=e.sent,i=function(e){switch(e.castState){case cast.framework.CastState.NO_DEVICES_AVAILABLE:break;case cast.framework.CastState.NOT_CONNECTED:t.onRemoteDevice(!0);break;case cast.framework.CastState.CONNECTED:var n=r.getCurrentSession();n&&n.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&t.onRemoteReconnect()}},r.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,i),r.setOptions({receiverApplicationId:"B3DCF968",autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),e.abrupt("return",i);case 10:e.prev=10,e.t0=e.catch(0),t.onRemoteDevice(!1);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return r.apply(this,arguments)}),n.prepareCastContext=(i=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.cast||!window.cast.framework){e.next=2;break}return e.abrupt("return",Promise.resolve(cast.framework.CastContext.getInstance()));case 2:return e.abrupt("return",new Promise(function(e,n){if(t.g.__onGCastApiAvailable=function(t){t?e(cast.framework.CastContext.getInstance()):n()},!document.getElementById(ew)){var r=document.createElement("script");r.id=ew,r.onerror=function(){document.body.removeChild(r),t.g.__onGCastApiAvailable=function(){},n()},r.async=!0,r.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(r)}}));case 3:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)});var r,i,a,o,s,u=n.prototype;return u.configure=(a=eg()(eS().mark(function e(t){var r,i,a,o,s,u,c;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.path,e.prev=1,e.next=4,n.prepareCastContext();case 4:if(o=(a=e.sent).getCurrentSession()){e.next=13;break}return e.next=9,a.requestSession();case 9:o=a.getCurrentSession(),this.setupRemotePlayerListeners(o),e.next=14;break;case 13:o.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&this.setupRemotePlayerListeners(o);case 14:return(s=new chrome.cast.media.MediaInfo(r,"")).streamType=chrome.cast.media.StreamType.BUFFERED,u=new chrome.cast.media.GenericMediaMetadata,s.metadata=u,s.customData={analytics:{chromecast_sender:"player-core",platform:"web"}},this.remotePlayerController.stop(),c=new chrome.cast.media.LoadRequest(s),this.seekTime>0&&(c.currentTime=this.seekTime,this.seekTime=0),this.currentDuration=0,e.next=25,null==(i=o)?void 0:i.loadMedia(c);case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(1),e.abrupt("return",this.handleError(e.t0));case 30:case"end":return e.stop()}},e,this,[[1,27]])})),function(e){return a.apply(this,arguments)}),u.stopMedia=(o=eg()(eS().mark(function e(t){var r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=!0),e.next=3,n.prepareCastContext();case 3:(r=e.sent.getCurrentSession())&&r.getSessionState()!==cast.framework.SessionState.SESSION_RESUMED&&r.endSession(t);case 6:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),u.invoke=function(e){this[e.name].call(this,e.arg)},u.play=function(){this.remotePlayer&&this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},u.pause=function(){this.remotePlayer&&!this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},u.seekTo=function(e){this.remotePlayer&&(this.remotePlayer.playerState!==chrome.cast.media.PlayerState.IDLE?(this.remotePlayer.currentTime=e,this.remotePlayerController.seek()):this.seekTime=e)},u.getCurrentTime=function(){return this.remotePlayer?this.remotePlayer.currentTime:0},u.delete=function(){this.remotePlayer&&this.stopMedia()},u.setMuted=function(e){this.remotePlayer&&e!==this.remotePlayer.isMuted&&this.remotePlayerController.muteOrUnmute()},u.isMuted=function(){return!!this.remotePlayer&&this.remotePlayer.isMuted},u.setVolume=function(e){this.remotePlayer&&(this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel())},u.getVolume=function(){return this.remotePlayer?this.remotePlayer.volumeLevel:0},u.getDevice=(s=eg()(eS().mark(function e(){var t;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.prepareCastContext();case 2:return t=e.sent.getCurrentSession(),e.abrupt("return",(null==t?void 0:t.getCastDevice().friendlyName)||"");case 5:case"end":return e.stop()}},e)})),function(){return s.apply(this,arguments)}),u.setupRemotePlayerListeners=function(e){var t,n=this,r=(t=eg()(eS().mark(function t(){var r,i;return eS().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(r=e.getMediaSession())&&(i=r.media,0===n.currentDuration&&null===i.duration&&(n.currentDuration=1/0,n.listener.onSinkDurationChanged(n.currentDuration)),n.listener.onSinkTimeUpdate());case 2:case"end":return t.stop()}},t)})),function(){return t.apply(this,arguments)}),i=function(){switch(n.remotePlayer.playerState){case chrome.cast.media.PlayerState.BUFFERING:n.listener.onSinkIdle();break;case chrome.cast.media.PlayerState.PLAYING:n.listener.onSinkPlaying(!1);break;case chrome.cast.media.PlayerState.IDLE:var t=e.getMediaSession();t&&t.idleReason===chrome.cast.media.IdleReason.FINISHED&&n.listener.onSinkEnded()}},a=function(){n.listener.onSinkVolumeChanged(n.remotePlayer.volumeLevel,!0)},o=function(){n.listener.onSinkMutedChanged(n.remotePlayer.isMuted)},s=function(){0!==n.remotePlayer.duration&&(n.currentDuration=n.remotePlayer.duration,n.listener.onSinkDurationChanged(n.currentDuration))},u=function(){n.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,r),n.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,i),n.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,a),n.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),n.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,s),n.listener.onSessionStop()};e.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,function(){n.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,r),n.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,i),n.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,a),n.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),n.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,s),n.listener.onSessionStarted(e.getCastDevice().friendlyName)});var c=e.getSessionObj();c.addUpdateListener(function(){c.status===chrome.cast.SessionStatus.STOPPED&&u()}),c.addMediaListener(u)},u.handleError=function(e){if(chrome.cast)switch(e){case chrome.cast.ErrorCode.SESSION_ERROR:this.listener.onSessionError();break;case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:this.listener.onRemoteDevice(!1);break;case chrome.cast.ErrorCode.LOAD_MEDIA_FAILED:this.listener.onLoadMediaError();break;case chrome.cast.ErrorCode.CANCEL:this.listener.onUserCancel();break;default:this.listener.onSinkError({value:1,code:0,message:"Error requesting chromecast session"})}else this.listener.onSinkError({value:1,code:0,message:"Error loading chromecast SDK"})},n}(eP),eD=function(e){function t(t){var n;return(n=e.call(this)||this).video=void 0,n.video=t,n}eT()(t,e);var n=t.prototype;return n.seekTo=function(e){this.video.currentTime=e},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getPlaybackRate=function(){return this.video.playbackRate},t}(eP),eM=function(){function e(e,t){this.muted=void 0,this.video=void 0,this.listener=void 0,this.unsubscribes=[],this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1,this.expectedRateChange=void 0,this.video=e,this.listener=t,this.muted=e.muted,this.unsubscribes.push(k(e,"volumechange",this.volumeChange.bind(this))),this.unsubscribes.push(k(e,"ratechange",this.rateChange.bind(this)))}var t=e.prototype;return t.volumeChange=function(){var e=!this.expectingVolumeChanged;this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1;var t=this.video.muted;this.muted!==t?(this.muted=t,this.listener.onSinkMutedChanged(t)):this.listener.onSinkVolumeChanged(this.video.volume,e)},t.rateChange=function(){this.video.playbackRate!==this.expectedRateChange&&this.listener.onSinkPlaybackRateChanged(this.video.playbackRate)},t.unsubscribe=function(){this.unsubscribes.forEach(function(e){return e()})},t.onConfigure=function(){this.expectingVolumeChanged&&(this.listener.onSinkVolumeChanged(this.video.volume,!1),this.expectingVolumeChanged=!1),this.expectingMutedChanged&&(this.muted=this.video.muted,this.listener.onSinkMutedChanged(this.video.muted),this.expectingMutedChanged=!1),this.expectedRateChange=void 0},t.trackRPC=function(e){var t=e.name,n=e.arg;"setVolume"===t&&this.video.volume!==n?this.expectingVolumeChanged=!0:"setMuted"===t&&this.video.muted!==n?this.expectingMutedChanged=!0:"setPlaybackRate"===t&&this.video.playbackRate!==n&&(this.expectedRateChange=n)},e}(),eL=n(76263),e_=t.n(eL),eR=("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:void 0).Promise||e_(),eI=function(e){function t(t,n){var r;return(r=e.call(this)||this).paused=!0,r.listener=void 0,r.video=void 0,r.unsubscribers=void 0,r.lastVolumeChangeEvent=void 0,r.video=t,r.listener=n,r.paused=!0,r.unsubscribers=[],r.addListener("volumechange",r.recordMuteChange.bind(r)),r.recordMuteChange(),r}eT()(t,e);var n=t.prototype;return n.pause=function(){this.paused=!0,this.video.pause()},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.delete=function(){this.unsubscribers.forEach(function(e){return e()})},n.addListener=function(e,t,n){void 0===n&&(n=this.video),this.unsubscribers.push(k(n,e,t))},n.recordMuteChange=function(){this.lastVolumeChangeEvent={time:this.video.currentTime,muted:this.video.muted}},n.checkStopped=function(e){return!this.video.paused||this.video.ended||this.video.error||this.paused||this.listener.onSinkStop(e||this.unmuteAutopause()),!1},n.unmuteAutopause=function(){var e=this.lastVolumeChangeEvent;return!this.video.muted&&!e.muted&&this.video.currentTime===e.time},t}(eP),ex=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this).onSinkIdle=void 0,r.intervalId=void 0,r.idle=void 0,r.lastPlayhead=void 0,r.lastBufferEnd=void 0,r.idleTimeout=void 0,r.playAttempt=!1,r.seeking=!1,r.audioBufferList=void 0,r.awaitingAutoplayCompletion=!1,r.intervalId=0,r.idle=!0,r.lastPlayhead=0,r.lastBufferEnd=0,r.idleTimeout=-1,r.audioBufferList=[],r.bindEvents(),r}eT()(t,e);var n=t.prototype;return n.bindEvents=function(){var e=this;this.addListener("play",function(){return e.onVideoPlay()}),this.addListener("pause",function(){return e.onVideoPause()}),this.addListener("timeupdate",function(){return e.onVideoTimeUpdate()}),this.addListener("ended",function(){return e.onVideoEnded()}),this.addListener("error",function(){return e.onVideoError()}),this.addListener("playing",function(){return e.onVideoPlaying()}),this.addListener("seeking",function(){return e.onVideoSeeking()})},n.delete=function(){e.prototype.delete.call(this),this.audioBufferList=[],clearInterval(this.intervalId)},n.play=function(){this.paused=!1;for(var e=this.video.buffered,t=0,n=0;n<e.length;n++){var r=e.start(n);if(this.video.currentTime<=r){t=r;break}}this.video.currentTime<t&&(console.warn("Moving to buffered region",t,this.video.currentTime),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.playInternal()},n.endOfStream=function(){this.idle=!1,clearTimeout(this.idleTimeout),this.idleTimeout=-1},n.seekTo=function(e){this.video.seekable.length&&e!==this.video.currentTime&&(this.seeking=!0,this.video.currentTime=e)},n.addSourceBuffer=function(e,t){(t.indexOf("mp4a")>-1||t.indexOf("opus")>-1)&&(this.audioBufferList=[e])},n.clearSourceBuffers=function(){this.audioBufferList=[]},n.onIdle=function(){var e;this.listener.onSinkIdle(),null==(e=this.onSinkIdle)||e.call(this)},n.onVideoPlay=function(){var e=this;this.playAttempt?(this.lastPlayhead=this.video.currentTime,clearInterval(this.intervalId),this.intervalId=self.setInterval(function(){return e.heartbeat()},3e3)):(this.pause(),this.listener.play()),this.playAttempt=!1},n.onVideoPause=function(){this.awaitingAutoplayCompletion||(this.checkStopped(!1),clearInterval(this.intervalId))},n.onVideoTimeUpdate=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.listener.onSinkTimeUpdate();var e=y(this.video.buffered,this.video.currentTime,.1);this.checkBufferUpdate(e),this.updateIdle(e)},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){this.video.paused||this.listener.onSinkPlaying(this.paused)},n.onVideoSeeking=function(){this.seeking?this.seeking=!1:this.listener.seekTo(this.video.currentTime)},n.onVideoError=function(){var e,t,n=null!=(e=null==this||null==(t=this.video)?void 0:t.error)?e:{},r=n.code,i=void 0===r?-1:r,a=n.message;this.listener.onSinkError({value:i,code:i,message:void 0===a?"":a})},n.heartbeat=function(){var e=y(this.video.buffered,this.video.currentTime,.1);if(this.video.paused)clearInterval(this.intervalId);else if(this.video.currentTime===this.lastPlayhead){var t=S(this.video.buffered,this.video.currentTime,.1);t!==this.video.currentTime&&(this.audioBufferList.map(function(e){g("Audio Buffer",e.buffered)}),g("<video> Buffer",this.video.buffered),console.warn("jumping "+(t-this.video.currentTime)+"s gap, current position "+this.video.currentTime+", new position "+t),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.updateIdle(e,t===this.video.currentTime)}else this.checkBufferUpdate(e),this.lastPlayhead=this.video.currentTime},n.checkBufferUpdate=function(e){var t=e.end;t!==this.lastBufferEnd&&(this.lastBufferEnd=t,this.listener.onSinkBufferUpdate())},n.updateIdle=function(e,t){var n=this,r=e.end,i=void 0===r?0:r;void 0===t&&(t=!1);var a=this.video,o=a.buffered,s=a.currentTime;if(a.paused)this.idle=!0;else{var u=[i].concat(this.audioBufferList.map(function(e){return y(e.buffered,s,.1).end})),c=Math.max.apply(null,u);Number.isFinite(c)||(c=0);var d=o.length,l=d>0?o.end(d-1):i,h=c-s<.1||t&&i>l;h&&!this.idle&&(console.warn("playhead",s,"max buffer",c,"max played",l),clearTimeout(this.idleTimeout),this.idleTimeout=self.setTimeout(function(){return n.onBufferingTimeout()},12e4),this.onIdle()),this.idle=h}},n.onBufferingTimeout=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.listener.onSinkError({value:101,code:101,message:"Buffering timeout"})},n.playInternal=function(){var e=this;this.playAttempt=!0,this.awaitingAutoplayCompletion=!0,eR.resolve(this.video.play()).then(function(){e.awaitingAutoplayCompletion=!1}).catch(function(){e.playAttempt=!1,e.checkStopped(!0)})},t}(eI),eV=function(e){function t(t,n){var r;return(r=e.call(this)||this).listener=t,r.video=n,r.playbackMonitor=void 0,r.controlsObserver=void 0,r.playbackMonitor=new ex(n,t),r.observeControlsChange(),r}eT()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.srcObj;this.video.srcObject||(this.video.srcObject=t)},n.invoke=function(e){this[e.name].call(this,e.arg)},n.play=function(){this.playbackMonitor.play()},n.pause=function(){this.playbackMonitor.pause()},n.seekTo=function(e){this.playbackMonitor.seekTo(e)},n.endOfStream=function(){this.playbackMonitor.endOfStream()},n.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},n.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.buffered=function(){return y(this.video.buffered,this.video.currentTime,.1)},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},n.changeSrcObj=function(e){var t=this.video,n=t.playbackRate;t.srcObject=e,t.playbackRate=n},n.delete=function(){var e;this.playbackMonitor.delete(),this.video.srcObject=null,b(this.video),null==(e=this.controlsObserver)||e.disconnect()},n.observeControlsChange=function(){var e=this.listener,t=this.video;try{(this.controlsObserver=new MutationObserver(function(){e.onSinkControlsChanged(t.controls)})).observe(t,{attributeFilter:["controls"]}),e.onSinkControlsChanged(t.controls)}catch(e){}},t}(eP),eO=function(){function e(e,t,n){void 0===n&&(n=new ex(t,e)),this.listener=e,this.video=t,this.playbackMonitor=n,this.controlsObserver=void 0,this.mseSink=void 0,this.awaitSink=void 0,this.observeControlsChange(),this.awaitSink=void 0,k(t,"error",this.onVideoError.bind(this))}var t=e.prototype;return t.invoke=function(e){var t=this.awaitSink,n=this.mseSink;t&&n?["enqueue","addTrack","setTimestampOffset"].includes(e.name)?this.invokeAsync(e):this.invokeSync(e):t?this.invokeAsync(e):n&&this.invokeSync(e)},t.initSink=function(){var e=this,t=this.awaitSink;if(!this.mseSink&&!t){var n=T.create(this.onMediaSourceEnded.bind(this),this.onMediaSourceError.bind(this));this.awaitSink=new eR(function(t,r){n.sink.then(function(n){e.handleCreateSuccess(n),t()}).catch(function(t){e.handleCreateError(t),r()})}),this.changeSrc(URL.createObjectURL(n.ms))}},t.configure=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected;this.initSink(),!this.awaitSink&&(this.isContentProtectionChanging(e)||this.isChangingToFromAudioOnly(e))&&this.queueNewSink(),this.invoke({name:"addTrack",arg:I()({},eN,{trackID:t,codec:n,group:r,isProtected:i})})},t.queueNewSink=function(){var e=this;this.awaitSink=new eR(function(t,n){e.deferUntilIdle().then(function(){var t=T.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink}).then(function(n){e.destroyMSESink(),e.handleCreateSuccess(n),e.play(),t()}).catch(function(t){e.handleCreateError(t),n()})})},t.addTrack=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected,a=this.mseSink;try{var o=null==a?void 0:a.addTrack(t,n,r,i);o&&this.playbackMonitor.addSourceBuffer(o,n)}catch(e){this.handleCreateError(e)}},t.enqueue=function(e){var t,n=e.trackID,r=e.buffer;null==(t=this.mseSink)||t.append(n,r)},t.endOfStream=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then(function(){return t.playbackMonitor.endOfStream()})},t.setTimestampOffset=function(e){var t,n=e.trackID,r=e.offset;null==(t=this.mseSink)||t.setTimestampOffset(n,r)},t.onSourceDurationChanged=function(e){var t=this.mseSink,n=this.video;if(t){var r,i,a=t.duration,o=(r=n.controls,i=e,e===1/0||1073741824===e?r?i=1/0:r||(i=1073741824):e!==a&&(i=e),i);o!==a&&t.setDuration(o)}},t.play=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then(function(){return t.playbackMonitor.play()})},t.pause=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then(function(){return t.playbackMonitor.pause()})},t.remove=function(e){var t,n=e.start,r=e.end;null==(t=this.mseSink)||t.remove(n,r)},t.seekTo=function(e){var t=this.mseSink,n=this.playbackMonitor,r=this.video,i=y(r.buffered,r.currentTime,.1),a=i.start,o=i.end;e>=a&&e<o?null==t||t.scheduleUpdate().then(function(){return n.seekTo(e)}):n.seekTo(e)},t.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},t.getVolume=function(){return this.video.volume},t.isMuted=function(){return this.video.muted},t.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},t.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},t.getPlaybackRate=function(){return this.video.playbackRate},t.getCurrentTime=function(){return this.video.currentTime},t.buffered=function(){return y(this.video.buffered,this.video.currentTime,.1)},t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.mseSink)?void 0:n.getBufferedRanges(e))?t:[]},t.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},t.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},t.changeSrc=function(e){var t,n,r;n=(t=this.video).playbackRate,(r=t.src)&&URL.revokeObjectURL(r),t.src=e,t.playbackRate=n},t.changeSrcObj=function(e){},t.delete=function(){var e;this.playbackMonitor.delete(),null==(e=this.controlsObserver)||e.disconnect(),this.destroyMSESink(),b(this.video)},t.invokeSync=function(e){this[e.name].call(this,e.arg)},t.invokeAsync=function(e){var t,n=this;null==(t=this.awaitSink)||t.then(function(){return n.invokeSync(e)}).catch(function(){})},t.onMediaSourceEnded=function(){this.video.load(),this.listener.onSinkReset()},t.destroyMSESink=function(){var e=this,t=function(){e.mseSink&&e.mseSink.destroy(),e.awaitSink=void 0,e.mseSink=void 0};this.mseSink?t():this.awaitSink&&this.awaitSink.then(function(){return t()}),this.playbackMonitor&&this.playbackMonitor.clearSourceBuffers()},t.isContentProtectionChanging=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isDrmProtected())&&t)!==e.isProtected},t.isChangingToFromAudioOnly=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isAudioOnly())&&t)!==("audio_only"===e.group)},t.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new eR(function(r){t&&!e.video.paused?n.onSinkIdle=function(){n.onSinkIdle=void 0,r()}:r()})},t.handleCreateSuccess=function(e){this.mseSink=e,this.awaitSink=void 0,this.onSourceDurationChanged(1073741824),this.mseSink.setLiveSeekableRange(0,1073741824)},t.handleCreateError=function(e){this.listener.onSinkError({value:4,code:4,message:e.toString()})},t.onMediaSourceError=function(e,t,n,r){var i={value:e,code:t,message:n};r?this.listener.onSinkError(i):this.listener.onSinkRecoverableError(i)},t.onVideoError=function(){this.destroyMSESink()},t.observeControlsChange=function(){var e=this,t=this.video;try{(this.controlsObserver=new MutationObserver(function(){e.invoke({name:"onSourceDurationChanged",arg:t.duration})})).observe(t,{attributeFilter:["controls"]})}catch(e){}},t.onSegmentDiscontinuity=function(){},e}(),eN={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},eF=n(63606),eU=function(){function e(){this.emitter=void 0,this.emitter=new eF.EventEmitter}var t=e.prototype;return t.on=function(e,t){this.emitter.on(String(e),t)},t.removeListener=function(e,t){this.emitter.removeListener(String(e),t)},t.emit=function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.emitter).emit.apply(t,[String(e)].concat(r))},t.removeAllListeners=function(){this.emitter.removeAllListeners()},e}(),eB=((e1={}).Pending="pending",e1.Ready="ready",e1.Configuring="configuring",e1.Active="active",e1.Error="error",e1),eH=((e2={}).Heartbeat="heartbeat",e2.Configure="configure",e2.Set_Log_Config="setLogConfig",e2.Debug="debug",e2.Destroy="destroy",e2),eG=((e3={}).State_Changed="stateChanged",e3.Manifest_Load_Analytics="manifestLoadAnalytics",e3.Available_Segments="availableSegments",e3);function eW(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ej={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0}},eq=new eU,eK=function(e){var t=e.name,n=function(e){if(ej.enabled&&ej.levels[e]){for(var n=(new Date).toTimeString().split(" ")[0],r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];console[e].apply(console,[n+" - ("+t+")"].concat(i))}};return{debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["debug"].concat(t))},log:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["log"].concat(t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["info"].concat(t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["warn"].concat(t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["error"].concat(t))}}},eQ=eK({name:"sw-host-config"});function eY(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eX(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?eX(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function eX(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ez,eJ,eZ,e$,e0,e1,e2,e3,e4,e8,e6=eK({name:"sw-host"}),e5=function(){return e8},e9=((e4=e9||{})[e4.Pending=0]="Pending",e4[e4.Installing=1]="Installing",e4[e4.Ready=2]="Ready",e4[e4.Error=3]="Error",e4),e7=function(e){var t=function(){return{isMSESupported:U()}};if((e?e.url||(eQ.error("Service worker config must specify a url"),0):(eQ.error("Service worker config is required"),0))&&(n=t(),!(!e.forceActivate&&n.isMSESupported))){var n,r,i,a,o,s,u,c,d,l,h,f,v,p,m,g,y,S,k,b,E,C,T,P,w,A,D,M,L,_,R,x,V,O,N=new eU,F=!0,B=e9.Pending,H=[],G=[],W=[],j=eB.Pending,q=!1,K=(r=eg()(eS().mark(function t(){var n,r;return eS().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,X(e9.Installing),navigator.serviceWorker.addEventListener("message",J),t.prev=3,t.next=6,Q(e.url);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),e6.error("[registerAndActivate] Failed to unregister service worker instances: "+t.t0);case 11:return n=void 0!==e.scope?{scope:e.scope}:void 0,t.next=14,navigator.serviceWorker.register(e.url,n);case 14:return(r=t.sent).installing?e6.log("Service worker installing"):r.waiting?e6.log("Service worker installed"):r.active&&e6.log("Service worker active"),t.next=18,Y(r);case 18:X(e9.Ready),t.next=25;break;case 21:t.prev=21,t.t1=t.catch(0),e6.error("Registration failed with "+t.t1),X(e9.Error);case 25:case"end":return t.stop()}},t,null,[[0,21],[3,8]])})),function(){return r.apply(this,arguments)}),Q=(i=eg()(eS().mark(function e(t){var n;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RegExp(t),e.next=3,navigator.serviceWorker.getRegistrations().then(function(){var e=eg()(eS().mark(function e(t){var r,i,a;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e6.debug("[unregisterOtherWorkerInstances] registrations",t),r=eY(t);case 2:if((i=r()).done){e.next=16;break}if(null===(a=i.value).active||!n.test(a.active.scriptURL)){e.next=14;break}return e6.debug("[unregisterOtherWorkerInstances] unregistering:",a),e.prev=6,e.next=9,a.unregister();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),e6.error("[unregisterOtherWorkerInstances] Failed to unregister service worker: "+e.t0);case 14:e.next=2;break;case 16:case"end":return e.stop()}},e,null,[[6,11]])}));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),Y=(a=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){null!==t.installing||null!==t.waiting?(t.installing||t.waiting).addEventListener("statechange",function(t){var r=t.target;e6.debug("sw registration, statechange",r.state),"activated"===r.state?(e6.log("Service worker activated"),e()):"redundant"===r.state&&n()}):e()}));case 1:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),X=function(e){if(e6.log("[changeHostState] host state changed from "+B+" to "+e),(B=e)===e9.Ready){var t=H.slice();H=[];for(var n,r=eY(t);!(n=r()).done;)(0,n.value)();var i=G.slice();G=[];for(var a,o=eY(i);!(a=o()).done;)Z(a.value)}else if(B===e9.Error){var s=W.slice();W=[];for(var u,c=eY(s);!(u=c()).done;)(0,u.value)()}},z=function(e){B===e9.Error?e():W.push(e)},J=function(e){var t=e.data;switch(t.type){case eG.State_Changed:var n=t.state;j===eB.Configuring&&(q=!1),n===eB.Ready&&j!==eB.Pending&&e6.warn("[handleMessage] worker was restarted by the browser"),j=n;break;case eG.Manifest_Load_Analytics:e6.debug("Manifest_Load_Analytics",t)}N.emit(t.type,t)},Z=(o=eg()(eS().mark(function e(t){var n;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e6.log("[sendMessage] sending message: ",t),e.abrupt("return",null==(n=navigator.serviceWorker.controller)?void 0:n.postMessage(t));case 2:case"end":return e.stop()}},e)})),function(e){return o.apply(this,arguments)}),$=(s=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(j!==eB.Pending){e.next=4;break}return e6.log("[sendMessageWhenReady] worker is not ready, queueing message",t),G.push(t),e.abrupt("return");case 4:Z(t);case 5:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)}),ee=function(){v&&clearTimeout(v),v=setTimeout(function(){et()},1e4)},et=function(){F&&j!==eB.Pending&&(Z({type:eH.Heartbeat}),ee())},en=function(e,t){N.on(eG.State_Changed,function n(r){r.type===eG.State_Changed&&r.state===e&&(N.removeListener(eG.State_Changed,n),t(r))})},er=(u=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(B!==e9.Ready){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise(function(e,t){var n;n=function(){e6.log("[ensureHostReady] host state changed to ready"),e()},B===e9.Ready?n():H.push(n),z(function(){e6.log("[ensureHostReady] host state changed to error"),t()})}));case 3:case"end":return e.stop()}},e)})),function(){return u.apply(this,arguments)}),ei=(c=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(j===eB.Pending){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise(function(e,t){en(eB.Ready,function(t){e6.log("[ensureWorkerReady] worker state changed to ready",t),e()})}));case 3:case"end":return e.stop()}},e)})),function(){return c.apply(this,arguments)}),ea=(d=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,er();case 2:return e.next=4,ei();case 4:case"end":return e.stop()}},e)})),function(){return d.apply(this,arguments)}),eo=(l=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return q=!0,f=es(null!=t?t:{}),e.next=4,ea();case 4:Z({type:eH.Configure,config:f});case 5:case"end":return e.stop()}},e)})),function(e){return l.apply(this,arguments)}),es=function(e){return I()({},f,e)},eu=(h=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(q||j!==eB.Active){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,ea();case 4:return e.abrupt("return",new Promise(function(e,t){en(eB.Active,function(t){e6.log("[ensureConfigured] worker state changed to active",t),e()})}));case 5:case"end":return e.stop()}},e)})),function(){return h.apply(this,arguments)}),ec=function(e){$({type:eH.Set_Log_Config,config:e})};return O=t().isMSESupported?{cacheMultivariant:!1,transformTargetDuration:!1,lowLatencyMode:{enabled:!1,useLocalSegment:!1,convertPrefetchSegment:!1,preloadPrefetchSegments:!1},driftDetection:{enabled:!1,maxPlaylistPosition:0,triggerDetectionThreshold:0,minDurationBetweenCorrections:0},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}}:{cacheMultivariant:!0,transformTargetDuration:!1,lowLatencyMode:{enabled:!0,useLocalSegment:!0,convertPrefetchSegment:!0,preloadPrefetchSegments:!1},driftDetection:{enabled:!0,maxPlaylistPosition:3,triggerDetectionThreshold:10,minDurationBetweenCorrections:60},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}},f={cacheMultivariant:null!=(p=e.cacheMultivariant)?p:O.cacheMultivariant,transformTargetDuration:null!=(m=e.transformTargetDuration)?m:O.transformTargetDuration,lowLatencyMode:{enabled:null!=(g=null==(y=e.lowLatencyMode)?void 0:y.enabled)?g:O.lowLatencyMode.enabled,useLocalSegment:null!=(S=null==(k=e.lowLatencyMode)?void 0:k.useLocalSegment)?S:O.lowLatencyMode.useLocalSegment,convertPrefetchSegment:null!=(b=null==(E=e.lowLatencyMode)?void 0:E.convertPrefetchSegment)?b:O.lowLatencyMode.convertPrefetchSegment,preloadPrefetchSegments:null!=(C=null==(T=e.lowLatencyMode)?void 0:T.preloadPrefetchSegments)?C:O.lowLatencyMode.preloadPrefetchSegments},driftDetection:{enabled:null!=(P=null==(w=e.driftDetection)?void 0:w.enabled)?P:O.driftDetection.enabled,maxPlaylistPosition:null!=(A=null==(D=e.driftDetection)?void 0:D.maxPlaylistPosition)?A:O.driftDetection.maxPlaylistPosition,triggerDetectionThreshold:null!=(M=null==(L=e.driftDetection)?void 0:L.triggerDetectionThreshold)?M:O.driftDetection.triggerDetectionThreshold,minDurationBetweenCorrections:null!=(_=null==(R=e.driftDetection)?void 0:R.minDurationBetweenCorrections)?_:O.driftDetection.minDurationBetweenCorrections},debug:{addMultivariantDelay:null==(x=e.debug)?void 0:x.addMultivariantDelay,addFirstVariantDelay:null==(V=e.debug)?void 0:V.addFirstVariantDelay}},e6.info("[init] instantiating with config",f),void 0!==e.debug&&(e.debug.api={delayNextMediaManifest:function(e){!function(e){if("delayNextMediaManifest"===e.api){var t=e.delayInMs;e6.log("[handleDebugApiMessage] delaying next manifest by "+t+"ms")}Z(I()({type:eH.Debug},e))}({api:"delayNextMediaManifest",delayInMs:e})}}),eq.on("logConfigUpdated",ec),ee(),{registerAndActivate:K,addListener:function(e,t){N.on(e,t)},removeListener:function(e,t){N.removeListener(e,t)},sendMessage:Z,ensureReady:ea,configure:eo,ensureConfigured:eu,getConfig:function(){return f},getDriftDetectionConfig:function(){var e;return null==(e=f)?void 0:e.driftDetection},setLogConfig:ec,destroy:function(){e6.log("[destroy] destroying"),F=!1,v&&clearTimeout(v),N.removeAllListeners(),eq.removeListener("logConfigUpdated",ec),navigator.serviceWorker.removeEventListener("message",J),Z({type:eH.Destroy})},debugPassthroughAnalytics:function(t){var n;null==(n=e.debug)||null==n.onPassthroughAnalytics||n.onPassthroughAnalytics(t)}}}},te=function(){function e(){this.serverOffsetVal=e.SERVER_OFFSET_DEFAULT,this.liveLatencyVal=0,this.lastTranscodeReceive=-1}var t=e.prototype;return t.tryGenerateServerOffset=function(t){var n;return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT?(console.warn("[generateServerOffset] the server offset has already been generated, skipping"),!1):(this.serverOffsetVal=(n=Date.now(),new Date(1e3*t).getTime()-n),!0)},t.tryUpdateLatency=function(t){return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT&&(t<this.lastTranscodeReceive?(console.warn("[updateLatency] received latency values too old, ignoring. previous: "+this.lastTranscodeReceive+" current: "+t),!1):(this.liveLatencyVal=(Date.now()+this.serverOffsetVal-t)/1e3,this.lastTranscodeReceive=t,!0))},o()(e,[{key:"serverOffset",get:function(){return this.serverOffsetVal}},{key:"liveLatency",get:function(){return this.liveLatencyVal}}])}();te.SERVER_OFFSET_DEFAULT=-1;var tt=function(e){var t=parseFloat(e);if(!isNaN(t))return t},tn=((tH={}).Live_Latency_Load="liveLatencyLoad",tH.Live_Latency_Stats="liveLatencyStats",tH),tr=((tG={}).Trigger_Drift_Correction="triggerDriftCorrection",tG),ti=((tW=ti||{}).ID3="org.id3",tW.APPLE_HLS="com.apple.quicktime.HLS",tW),ta=((tj=ta||{}).PRIV="PRIV",tj.TXXX="TXXX",tj.TDEN="TDEN",tj.STREAM_LEVEL_SERVER_TIME="X-SERVER-TIME",tj),to=eK({name:"sink"}),ts=function(e){function t(t,n){(r=e.call(this,n,t)||this).intervalId=void 0,r.bufferingTimeoutId=void 0,r.attemptingToPlay=void 0,r.hasPlayedSrc=void 0,r.hasReloadedOnDecodeError=void 0,r.unsubscribersForTrackEvents=void 0,r.latencyStatistics=void 0,r.processedInitialCues=void 0,r.serviceWorker=void 0,r.serviceWorkerHandler=void 0,r.positionTracker=void 0,r.driftDetector=void 0,r.driftDetectorHandler=void 0,r.analytics=void 0,r.analyticsHandler=void 0,r.intervalId=-1,r.bufferingTimeoutId=-1,r.attemptingToPlay=!1,r.hasPlayedSrc=!1,r.hasReloadedOnDecodeError=!1,r.unsubscribersForTrackEvents=[],r.latencyStatistics=new te,r.processedInitialCues=!1,r.addListener("waiting",function(){return r.onVideoWaiting()},r.video),r.addListener("timeupdate",function(){return r.onVideoTimeUpdate()},r.video),r.addListener("durationchange",function(){return r.onVideoDurationChange()},r.video),r.addListener("error",function(){return r.onVideoError()},r.video),r.addListener("play",function(){return r.onVideoPlay()},r.video),r.addListener("pause",function(){return r.onVideoPause()},r.video),r.addListener("ended",function(){return r.onVideoEnded()},r.video),r.addListener("playing",function(){return r.onVideoPlaying()},r.video);var r,i,a,o,s,u,c,l,h,f,v,p,m,g,y,S=d(document).visibilityChange;if(r.addListener(S,function(){return r.onVisibilityChange()},document),r.serviceWorker=e5(),r.serviceWorkerHandler=function(e){return r.onServiceWorkerMessage(e)},r.addServiceWorkerListeners(),void 0!==r.serviceWorker){r.positionTracker=(p=[],m=-1,g=function(){return 0===p.length||void 0===v?(m=-1,!1):-1!==(m=y(v))},y=function(e){var t=RegExp("^"+e);if(p){var n=p.findIndex(function(e){return t.test(e.pdt)});if(-1===n)for(var r=new Date(e+"Z"),i=0;i<p.length;i++){var a=p[i],o=new Date(a.pdt);if(o.getTime()<=r.getTime()&&o.getTime()+1e3*a.duration>r.getTime()){n=i;break}}if(-1!==n)return n}return console.warn("Couldn't find segment for PDT "+e),-1},{processAvailableSegments:function(e){return p=e,g()},processTDEN:function(e){return v=e,g()},getCurrentPosition:function(){return m}});var k,b,E,C,T,P,w,A,D,M,L,_,R,x=null==(R=r.serviceWorker)?void 0:R.getDriftDetectionConfig();void 0!==x&&x.enabled&&(r.driftDetector=(i={maxPlaylistPosition:x.maxPlaylistPosition,triggerDetectionThreshold:x.triggerDetectionThreshold,minDurationBetweenCorrections:x.minDurationBetweenCorrections},u=new eU,c=0,l=0,h=function(){if(void 0!==a&&void 0!==o){if(a<=i.maxPlaylistPosition)l=0;else if((l+=1)>i.triggerDetectionThreshold){console.debug("[handleDriftDetection] above detection threshold");var e=Date.now();(void 0===s||e-s>i.minDurationBetweenCorrections)&&(console.debug("[handleDriftDetection] within min duration, triggering rebuffer-to-live"),f(e,a,o))}}},f=function(e,t,n){c+=1,s=e,l=0;var r={type:tr.Trigger_Drift_Correction,playlistPosition:t,playhead:n,rebufferCount:c};u.emit(tr.Trigger_Drift_Correction,r)},{addListener:function(e,t){u.on(e,t)},removeListener:function(e,t){u.removeListener(e,t)},processPlaylistPosition:function(e){a=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==o&&t===o||(o=t,h())}}),r.driftDetectorHandler=function(e){return r.onDriftDetectorEvent(e)},r.addDriftDetectorListeners()),r.analytics=(T=new eU,P={},w={duration:0},A={min:0,avg:0,max:0,last:0},D={first:void 0,last:void 0},M={count:0},L=function(){if((e=tn.Live_Latency_Load)===tn.Live_Latency_Load&&void 0===P[e]&&void 0!==k&&void 0!==b){var e,t=P[tn.Live_Latency_Load]||0;P[tn.Live_Latency_Load]=t+1,T.emit(tn.Live_Latency_Load,{type:tn.Live_Latency_Load,serverOffset:k,manifestLoadAnalytics:b})}},_=function(){var e=P[tn.Live_Latency_Stats]||0;P[tn.Live_Latency_Stats]=e+1,T.emit(tn.Live_Latency_Stats,{type:tn.Live_Latency_Stats,playlistPosition:I()({},A),liveLatencyTiming:I()({},D),driftCorrection:I()({},M)})},{addListener:function(e,t){T.on(e,t)},removeListener:function(e,t){T.removeListener(e,t)},processServerOffset:function(e){k={serverTime:1e3*e.serverTime,clientTime:e.clientTime,serverOffset:e.serverOffset},L()},processManifestLoadAnalytics:function(e){b=e,L()},processSinkState:function(e){"playing"===E&&"pause"===e&&_(),E=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==C&&t===C||(w.duration+=1,C=t,w.duration%10==0&&_())},processPlaylistPosition:function(e){e<A.min&&(A.min=e),e>A.max&&(A.max=e),0===A.avg?A.avg=e:A.avg=(A.avg*w.duration+e)/(w.duration+1),A.last=e},processLiveLatencyUpdate:function(e){void 0===D.first&&(D.first=I()({},e)),D.last=I()({},e)},processDriftCorrectionStart:function(){M.count+=1}}),r.analyticsHandler=function(e){return r.onAnalyticsEvent(e)},r.addAnalyticsListeners()}return r}eT()(t,e);var n=t.prototype;return n.invoke=function(e){this[e.name].call(this,e.arg)},n.configure=function(e){var t=e.path;this.handleTrackEvents(),this.hasReloadedOnDecodeError=!1,this.hasPlayedSrc=!1,this.video.src=t},n.play=function(){var e=this,t=this.video.buffered;if(t.length>0){var n=t.start(t.length-1),r=t.end(t.length-1);this.video.duration===1/0&&(r<this.video.currentTime||this.video.currentTime<n)&&(this.listener.onSinkGapJump(n-this.video.currentTime),console.warn("Moving to buffered region"),this.video.currentTime=n)}this.paused=!1,this.attemptingToPlay=!0,(void 0===e.serviceWorker||e.hasPlayedSrc?Promise.resolve(e.video.play()):e.serviceWorker.ensureConfigured().catch(function(e){to.warn("sw, ensureConfigured failed",e)}).then(function(){return Promise.resolve(e.video.play())})).then(function(){e.attemptingToPlay=!1,e.hasPlayedSrc=!0}).catch(function(){e.attemptingToPlay=!1,e.checkStopped(!0)})},n.pause=function(){e.prototype.pause.call(this),clearTimeout(this.intervalId)},n.seekTo=function(e){this.video.currentTime=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.buffered=function(){return y(this.video.buffered,this.video.currentTime,.1)},n.decodedFrames=function(){return p(this.video)},n.droppedFrames=function(){return m(this.video)},n.delete=function(){e.prototype.delete.call(this),this.removeTrackListeners(),this.removeServiceWorkerListeners(),this.removeDriftDetectorListeners(),this.removeAnalyticsListeners(),this.video.src="",this.video.load()},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.captureGesture=function(){Promise.resolve(this.video.play()).catch(function(){}),this.video.pause()},n.addServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.addListener(eG.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.addListener(eG.Available_Segments,this.serviceWorkerHandler))},n.onServiceWorkerMessage=function(e){var t,n;switch(e.type){case eG.Manifest_Load_Analytics:null==(t=this.analytics)||t.processManifestLoadAnalytics(e.data);break;case eG.Available_Segments:null==(n=this.positionTracker)||n.processAvailableSegments(e.segments)}},n.removeServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.removeListener(eG.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.removeListener(eG.Available_Segments,this.serviceWorkerHandler))},n.addDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.addListener(tr.Trigger_Drift_Correction,this.driftDetectorHandler)},n.onDriftDetectorEvent=function(e){var t;e.type===tr.Trigger_Drift_Correction&&(to.debug("triggering drift correction",e),null==(t=this.analytics)||t.processDriftCorrectionStart(),this.resumeAtLive())},n.resumeAtLive=function(){this.pause(),this.configure({path:this.video.src}),this.play()},n.removeDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.removeListener(tr.Trigger_Drift_Correction,this.driftDetectorHandler)},n.addAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.addListener(tn.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.addListener(tn.Live_Latency_Stats,this.analyticsHandler)},n.onAnalyticsEvent=function(e){var t;switch(null==(t=this.serviceWorker)||t.debugPassthroughAnalytics(e),e.type){case tn.Live_Latency_Load:to.debug("analytics event, Live Latency Load",e.serverOffset,e.manifestLoadAnalytics);break;case tn.Live_Latency_Stats:to.debug("analytics event, Live Latency Stats",e.playlistPosition,e.liveLatencyTiming,e.driftCorrection)}},n.removeAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.removeListener(tn.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.removeListener(tn.Live_Latency_Stats,this.analyticsHandler)},n.addTrackListener=function(e,t,n){this.unsubscribersForTrackEvents.push(k(n,e,t))},n.removeTrackListeners=function(){this.unsubscribersForTrackEvents.forEach(function(e){return e()})},n.checkTracksStatus=function(){for(var e=this.video.textTracks,t=0;t<e.length;t++){var n=e[t];"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden")}},n.handleTDENDataReceived=function(e){if(void 0!==this.positionTracker&&this.positionTracker.processTDEN(e)){var t,n,r=this.positionTracker.getCurrentPosition();null==(t=this.analytics)||t.processPlaylistPosition(r),null==(n=this.driftDetector)||n.processPlaylistPosition(r)}},n.handleTXXXSegmentDataReceived=function(e){var t,n=function(e){var t=u(e);if("transc_r"in t)return{transc_r:parseInt(t.transc_r)}}(e);void 0!==n&&(n.transc_r>0&&this.listener.onPassthroughSinkPropertyChanged("transcodeReceiveInSecs",n.transc_r/1e3),this.latencyStatistics.tryUpdateLatency(n.transc_r)&&(this.listener.onPassthroughSinkPropertyChanged("liveLatency",this.latencyStatistics.liveLatency),null==(t=this.analytics)||t.processLiveLatencyUpdate({transc_r:n.transc_r,latency:this.latencyStatistics.liveLatency})))},n.handleInitialCues=function(e){for(var t,n,r=0;r<e.length;++r){var i=e[r];i.type===ti.APPLE_HLS&&i.value.key===ta.STREAM_LEVEL_SERVER_TIME&&(t=tt(i.value.data))}this.processedInitialCues=!0,void 0!==t&&this.latencyStatistics.tryGenerateServerOffset(t)&&(null==(n=this.analytics)||n.processServerOffset({serverTime:t,clientTime:Date.now(),serverOffset:this.latencyStatistics.serverOffset}))},n.shouldPropagateCue=function(e){var t=e.type,n=e.value;return!(t!==ti.ID3||!n||!(n.key===ta.TXXX&&"segmentmetadata"!==n.info||n.key===ta.PRIV&&n.info===ef.METADATA_ID||n.key===ta.PRIV&&n.info===ef.INBAND_METADATA_ID))},n.handleCueChange=function(e){var t=this,n=new Set;this.addTrackListener("cuechange",function(){!t.processedInitialCues&&e.cues&&t.handleInitialCues(e.cues);var r,i=null!=(r=e.activeCues)?r:[];if(i.length>0){for(var a=new Set,o=0;o<i.length;++o){var s=i[o];if(!n.has(s)){s.type;var u=s.value;if(u.key===ta.TXXX&&"segmentmetadata"===u.info&&t.handleTXXXSegmentDataReceived(u.data),u.key===ta.TDEN&&t.handleTDENDataReceived(u.data),t.shouldPropagateCue(s)){var c=u.key===ta.PRIV?new TextDecoder("utf-8").decode(u.data):u.data||"",d=u.info||"";t.listener.onPassthroughSinkMetadata(s.startTime,s.endTime,c,d,d)}}a.add(s)}n=a}},e)},n.handleTrackEvents=function(){var e=this;this.removeTrackListeners(),void 0===window.DataCue&&void 0===window.WebKitDataCue||(this.addTrackListener("change",function(){e.checkTracksStatus()},this.video.textTracks),this.addTrackListener("addtrack",function(t){var n=t.track;"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden",e.handleCueChange(n))},this.video.textTracks))},n.onVideoWaiting=function(){var e=this;if(y(this.video.buffered,this.video.currentTime,.1).end-this.video.currentTime<.1){this.listener.onSinkIdle(),clearTimeout(this.bufferingTimeoutId),this.bufferingTimeoutId=self.setTimeout(function(){e.listener.onSinkError({value:101,code:101,message:"Buffering timeout"})},12e4);var t=k(this.video,"timeupdate",function(){t(),clearTimeout(e.bufferingTimeoutId)})}var n=k(this.video,"timeupdate",function(){4===e.video.readyState&&(n(),e.onVideoPlaying())})},n.onVideoTimeUpdate=function(){var e,t;this.listener.onSinkTimeUpdate(),null==(e=this.analytics)||e.processTimeUpdate(this.getCurrentTime()),null==(t=this.driftDetector)||t.processTimeUpdate(this.getCurrentTime())},n.onVideoDurationChange=function(){this.listener.onSinkDurationChanged(this.video.duration)},n.onVideoError=function(){var e=this.video.error,t=e.code,n=e.message,r=void 0===n?"":n,i=-1!==this.video.src.indexOf(".m3u8");if(4===t&&!this.hasPlayedSrc&&i)return clearTimeout(this.bufferingTimeoutId),void this.listener.onSinkError({value:404,code:404,message:r});3!==t||this.hasReloadedOnDecodeError?this.listener.onSinkError({value:t,code:t,message:r}):this.hasReloadedOnDecodeError||(this.hasReloadedOnDecodeError=!0,console.warn("Reload video element on MEDIA_ERR_DECODE 3"),this.video.load())},n.onVideoPlay=function(){var e=this,t=this.video.currentTime;clearTimeout(this.intervalId),this.intervalId=self.setTimeout(function(){return e.heartbeat(t)},3e3)},n.onVideoPause=function(){var e;clearTimeout(this.intervalId),this.attemptingToPlay||(null==(e=this.analytics)||e.processSinkState("pause"),this.checkStopped(!1))},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){var e;null==(e=this.analytics)||e.processSinkState("playing"),this.listener.onSinkPlaying(this.paused),this.trackBufferUpdate(y(this.video.buffered,this.video.currentTime,.1).end)},n.onVisibilityChange=function(){var e=d(document).hidden;document[e]&&(this.hasReloadedOnDecodeError=!1)},n.heartbeat=function(e){var t,n,r,i=this,a=this.video.currentTime;if(a===e){if(r=y((t=this.video).buffered,t.currentTime,.1).end-(n=t.currentTime),!(t.ended||t.duration-n<.1)&&r<.1)return void this.listener.onSinkIdle();var o=S(this.video.buffered,a,.1);o!==a&&(console.warn("jumping "+(o-a)+"s gap"),this.listener.onSinkGapJump(o-this.video.currentTime),this.video.currentTime=o,a=this.video.currentTime)}this.intervalId=self.setTimeout(function(){return i.heartbeat(a)},3e3)},n.trackBufferUpdate=function(e){var t=this,n=this.buffered().end;n!==e&&this.listener.onSinkBufferUpdate();var r=k(this.video,"timeupdate",function(){r(),t.trackBufferUpdate(n)})},t}(eI),tu=function(e){function t(){return e.apply(this,arguments)||this}return eT()(t,e),t.prototype.onIdle=function(){this.onSinkIdle?this.onSinkIdle():this.listener.onSinkIdle()},t}(ex),tc=function(e){function t(t,n,r){var i;return(i=e.call(this,t,n,new tu(n,t))||this).listener=t,i.video=n,i.adjustments=r,i}eT()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected;if(this.initSink(),this.isContentProtectionChanging(e)&&this.queueNewSink(),this.isNewSinkNeeded(e)){this.queueNewSink();var a=this.getTrack(v.audio);a&&this.invoke({name:"addTrack",arg:a})}this.invoke({name:"addTrack",arg:I()({},td,{trackID:t,codec:n,group:r,isProtected:i})})},n.queueNewSink=function(){var e=this;this.awaitSink=new Promise(function(t,n){e.deferUntilIdle().then(function(){var t=T.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink}).then(function(n){e.invokeAsync({name:"play",arg:void 0}),e.destroyMSESink(),e.handleCreateSuccess(n),t()}).catch(function(t){e.handleCreateError(t),n()})})},n.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new Promise(function(r){t&&!e.video.paused?(n.onSinkIdle=function(){},e.video.addEventListener("waiting",function(){n.onSinkIdle=void 0,r()},{once:!0})):r()})},n.onSegmentDiscontinuity=function(){var e=this.adjustments,t=this.awaitSink,n=this.mseSink;e.rebuildMediaSinkOnDiscontinuity&&n&&!t&&this.queueNewSink()},n.isSinkVideoSourceQualityChangeRequired=function(e,t){return!!this.adjustments.rebuildMediaSinkOnSourceQualityChange&&"chunked"===e!=("chunked"===t)},n.isNewSinkNeeded=function(e){var t=this.adjustments,n=this.mseSink,r=this.awaitSink;if(e.trackID!==v.video||!t.rebuildMediaSinkOnSourceQualityChange||!n||r)return!1;var i=this.getTrack(v.video),a=this.getTrack(v.audio);return!(!i||!a)&&this.isSinkVideoSourceQualityChangeRequired(i.group,e.group)},n.getTrack=function(e){var t,n=this.mseSink;return null!=(t=null==n?void 0:n.bufferProperties.find(function(t){return t.trackID===e}))?t:null},t}(eO),td={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},tl=function(){function e(e,t,n,r){this.listener=e,this.adjustments=n,this.video=void 0,this.drmManager=void 0,this.codecs=void 0,this.sink=void 0,this.observer=void 0,this.remoteDevicesListener=void 0,this.video=r,this.listener=e,this.drmManager=new eE({video:this.video,listener:e}),this.codecs=Object.create(null),this.sink=new eD(this.video),t&&(this.remoteDevicesListener=eA.lookForRemotePlaybackDevices(this.listener)),this.observer=new eM(this.video,e)}var t=e.prototype;return t.videoElement=function(){return this.video},t.delete=function(){var e;this.reset(),null==(e=this.remoteDevicesListener)||e.then(function(e){e&&eA.stopLookingForRemotePlaybackDevices(e)})},t.configure=function(e){var t=e.mode,n=e.codec,r=e.trackID;this.sink instanceof eD&&(this.sink=this.getSink(t)),n?this.codecs[r]=n:e.codec=this.codecs[r],this.sink.configure(e);var i=e.path,a=e.isProtected;i&&a&&this.drmManager.configure(i),this.observer.onConfigure()},t.applyRPC=function(e){this.observer.trackRPC(e),this.sink.invoke(e)},t.getCurrentSink=function(){return this.sink},t.reset=function(){this.sink.delete(),this.drmManager.reset(),this.sink=new eD(this.video),this.listener.onSinkTimeUpdate(),this.listener.onSinkBufferUpdate()},t.isProtected=function(){return this.drmManager.isProtected()},t.captureGesture=function(){this.video.played.length||this.sink.captureGesture()},t.destroy=function(){this.observer.unsubscribe(),this.delete()},t.isLowLatencyCapable=function(){return this.sink instanceof eO},t.onSegmentDiscontinuity=function(){this.sink.onSegmentDiscontinuity()},t.getSink=function(e){switch(e){case"chromecast":return new eA(this.listener);case"mse-worker":return new eV(this.listener,this.video);case"passthrough":return new ts(this.listener,this.video);case"webview":return new tc(this.listener,this.video,this.adjustments);default:return new eO(this.listener,this.video)}},e}(),th=((tq={})[tq.STATE_CHANGED=0]="STATE_CHANGED",tq[tq.CONFIGURE=1]="CONFIGURE",tq[tq.RESET=2]="RESET",tq[tq.ADD_CUE=3]="ADD_CUE",tq[tq.GET_DECODE_INFO=4]="GET_DECODE_INFO",tq[tq.MEDIA_SINK_RPC=5]="MEDIA_SINK_RPC",tq[tq.GET_EXPERIMENTS=6]="GET_EXPERIMENTS",tq[tq.LOG_MESSAGE=7]="LOG_MESSAGE",tq[tq.DATA_CHANNEL_CREATE=8]="DATA_CHANNEL_CREATE",tq[tq.DATA_CHANNEL_CLOSE=9]="DATA_CHANNEL_CLOSE",tq[tq.DATA_CHANNEL_SEND=10]="DATA_CHANNEL_SEND",tq[tq.RTC_SET_REMOTE_DESCRIPTION=11]="RTC_SET_REMOTE_DESCRIPTION",tq[tq.PROPERTY_CHANGED=12]="PROPERTY_CHANGED",tq[tq.SYNC_TIME_CHANGED=13]="SYNC_TIME_CHANGED",tq[tq.BUFFERED_RANGES=14]="BUFFERED_RANGES",tq[tq.DESTROY=15]="DESTROY",tq),tf={rebuildMediaSinkOnSourceQualityChange:!1,rebuildMediaSinkOnDiscontinuity:!1,abrTranscodesOnly:!1},tv=((tK={}).AVC="avc1",tK.HEVC="hvc1",tK.AV1="av01",tK),tp=((tQ={}).HEVC="b8b7cac6-956d-4819-8d35-9ae57aa5f0ce",tQ.AV1="d16629fa-a0bf-4a2a-b490-c1f92af05009",tQ.GPU="8b0cb43a-720b-4775-9f98-21da360d60b1",tQ),tm=function(){function e(e,t){var n;if(void 0===e&&(e={}),this.onConfigChanged=t,this.mainConfig=void 0,this.experimentHandler=void 0,this.defaultConfig={media:{codecConfigs:[]},logLevel:"",features:{gpu:{flags:{enable_render_surface:!1,add_canvas_to_surface:!1,allow_canvas_visible:!1,init_transformer:!1,run_transformer:!1}}},experiments:{}},this.resetMainConfig(),this.setupExperimentHandlers(),e.logLevel&&(this.mainConfig.logLevel=e.logLevel),e.media&&Object.assign(this.mainConfig.media,e.media),e.features&&(Object.assign(this.mainConfig.features,e.features),e.features.gpu&&Object.assign(null!=(n=this.mainConfig.features.gpu)?n:{},e.features.gpu)),e.experiments)for(var r=0,i=Object.values(e.experiments);r<i.length;r++){var a=i[r];a&&this.setExperiment(a.id,a.assignment)}}var t=e.prototype;return t.setupExperimentHandlers=function(){var e=this,t=this.handleExperiment(function(){return e.mainConfig.media.codecConfigs},ty,function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)}),n=this.handleExperiment(function(){return e.mainConfig.media.codecConfigs},tS,function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)}),r=this.handleExperiment(function(){return e.mainConfig.features.gpu},function(e,t){var n=tg(t),r=I()({},e);return n.flags&&(r.flags=I()({},r.flags,n.flags)),n.module&&(r.module=I()({},r.module,n.module)),n.render&&(r.render=I()({},r.render,n.render)),r},function(t){e.mainConfig.features.gpu=t});this.experimentHandler=new Map([[tp.HEVC,t],[tp.AV1,n],[tp.GPU,r]])},t.getConfigSnapshot=function(){return I()({},this.mainConfig)},t.setExperiment=function(e,t){var n;e&&t&&(this.mainConfig.experiments[e]={id:e,assignment:t,version:0},null==(n=this.experimentHandler.get(e))||n(t))},t.delete=function(){this.resetMainConfig()},t.resetMainConfig=function(){this.mainConfig=I()({},this.defaultConfig)},t.handleExperiment=function(e,t,n){var r=this;return function(i){var a=e(),o=t(a,i);o!==a&&(n(o),r.onConfigChanged())}},e}(),tg=function(e){var t={};if(!e)return t;var n=e.split("_config_"),r=(n[0],n[1]);if(!r)return t;try{t=JSON.parse(atob(r))}catch(t){console.warn("[ConfigManager]: Invalid assignment config provided",e,t)}return t};function ty(e,t){switch(t){case"control":case"holdback":return[{codecString:tv.HEVC,setting:{disableUse:!0}}];case"forceOn":return[{codecString:tv.HEVC,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}function tS(e,t){switch(t){case"control":case"holdback":return[{codecString:tv.AV1,setting:{disableUse:!0}}];case"forceOn":return[{codecString:tv.AV1,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}var tk=n(51720),tb=function(e){function t(t,n,r,i){var a;return(a=e.call(this,r)||this).source=t,a.code=n,a.message=r,a.fatal=i,a}return eT()(t,e),t}(t.n(tk)()(Error)),tE=((tY={})[tY.WebGPUNotAvailable=-1e3]="WebGPUNotAvailable",tY[tY.WebGPUAdapterNotAvailable=-1001]="WebGPUAdapterNotAvailable",tY[tY.WebGPUDeviceNotAvailable=-1002]="WebGPUDeviceNotAvailable",tY[tY.ShaderCompilationFailed=-1100]="ShaderCompilationFailed",tY[tY.PipelineCreationFailed=-1101]="PipelineCreationFailed",tY[tY.SamplerCreationFailed=-1102]="SamplerCreationFailed",tY[tY.StreamCreationFailed=-1103]="StreamCreationFailed",tY[tY.OutOfMemory=-1200]="OutOfMemory",tY[tY.InvalidBuffer=-1201]="InvalidBuffer",tY[tY.InvalidBufferSize=-1202]="InvalidBufferSize",tY[tY.DeviceLost=-1300]="DeviceLost",tY[tY.DeviceLostTooManyRetries=-1301]="DeviceLostTooManyRetries",tY[tY.CanvasCreationFailed=-1400]="CanvasCreationFailed",tY[tY.InferenceFailed=-1500]="InferenceFailed",tY[tY.FetchFailed=-1600]="FetchFailed",tY[tY.Render=-1700]="Render",tY[tY.Init=-1800]="Init",tY[tY.BadParameters=-9999]="BadParameters",tY),tC=function(){function e(e,t,n,r){this.inputFrameStream=e,this.sink=t,this.onError=n,this.config=r,this.pipeline=void 0,this.transformer=void 0,this.pipelineStats=void 0,this.resetStats(),this.pipeline=this.createPipeline()}var t,n,r,i=e.prototype;return i.stats=function(){return I()({},this.pipelineStats)},i.resetStats=function(){this.pipelineStats={received:0,overBudget:0,skipped:0,failed:0,transformed:0,rendered:0,transformTime:0,renderTime:0,totalProcessingTime:0,receiveDelay:0,endToEnd:0}},i.init=(t=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.transformer=t,e.prev=1,this.inputFrameStream.pipeThrough(this.pipeline),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",new tb("VideoFramePipeline",tE.StreamCreationFailed,e.t0.message,!0));case 8:return e.abrupt("return",void 0);case 9:case"end":return e.stop()}},e,this,[[1,5]])})),function(e){return t.apply(this,arguments)}),i.createPipeline=function(){var e,t=this,n=new TransformStream({transform:(e=eg()(eS().mark(function e(n){var r,i,a,o,s,u,c,d;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(performance.mark("Frame "+n.number+" received"),r=performance.now(),i=void 0,a=[],o=r-n.createdTimestamp,t.pipelineStats.receiveDelay+=o,t.pipelineStats.received++,s=1e3/t.config.minimumFramerate-(t.config.includeReceiveDelay?o:0),u=function(){var e=eg()(eS().mark(function e(){var o,u,c;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render(n,i);case 2:(o=e.sent.renderError)&&a.push(o),n.close(),c=(u=performance.now())-n.receivedTimestamp,t.pipelineStats.totalProcessingTime+=u-r,t.pipelineStats.endToEnd+=c,c>=s&&(console.warn("[VideoFramePipeline]: Frame "+n.number+" over budget. Budget: "+s+" Used: "+(u-n.receivedTimestamp)),t.pipelineStats.overBudget++),a.length&&t.pipelineStats.failed++,performance.mark("Frame "+n.number+" end"),a.forEach(function(e){return t.handleErrorInternal(e)});case 14:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),!(s<=0)){e.next=16;break}return console.warn("[VideoPipeline]: Frame "+n.number+" is late and will be skipped. Frame receive delay: "+o+", Initial budget: "+s+", Min budget: 0"),t.pipelineStats.skipped++,e.next=15,u();case 15:return e.abrupt("return");case 16:return e.next=18,t.frameToTexture(n,s);case 18:return d=(c=e.sent).transformError,i=c.texture,d&&a.push(d),e.next=25,u();case 25:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})});return n.readable.pipeTo(new WritableStream({write:function(){}})),n},i.frameToTexture=(n=eg()(eS().mark(function e(t,n){var r,i,a,o,s,u;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return performance.mark("Frame "+t.number+" transform start"),r=performance.now(),i=void 0,e.next=5,this.transformer.transform(t,n);case 5:return o=(a=e.sent).texture,(s=a.error)?(console.warn("[VideoFramePipeline]: Failed to transform frame "+t.number),i=s):this.pipelineStats.transformed++,u=performance.now()-r,this.pipelineStats.transformTime+=u,performance.mark("Frame "+t.number+" transform end"),e.abrupt("return",{transformError:i,texture:o,transformTime:u});case 13:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)}),i.render=(r=eg()(eS().mark(function e(t,n){var r,i,a,o,s,u,c;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return performance.mark("Frame "+t.number+" render start"),r=performance.now(),i=void 0,e.prev=3,s=null!=(a=null==n?void 0:n.width)?a:t.displayWidth,u=null!=(o=null==n?void 0:n.height)?o:t.displayHeight,this.sink.setDimensions(s*window.devicePixelRatio,u*window.devicePixelRatio),e.next=9,this.sink.render(null!=n?n:t);case 9:(i=e.sent)||this.pipelineStats.rendered++,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),console.warn("[VideoFramePipeline]: Failed to render frame "+t.number),i=e.t0;case 17:return c=performance.now()-r,this.pipelineStats.renderTime+=c,performance.mark("Frame "+t.number+" render end"),e.abrupt("return",{renderError:i,renderTime:c});case 21:case"end":return e.stop()}},e,this,[[3,13]])})),function(e,t){return r.apply(this,arguments)}),i.handleErrorInternal=function(e){console.warn("[VideoFramePipeline]: Error transforming frame",e),this.onError(e)},e}(),tT=function(){function e(e,t){this.config=e,this.onError=t,this.active=!1,this.frameStream=void 0,this.frameWriter=void 0,this.stopCapture=void 0,this.captureStats=void 0,this.resetStats()}var t=e.prototype;return t.init=function(){try{this.frameStream=new TransformStream({},{highWaterMark:this.config.maxQueueSize}),this.frameWriter=this.frameStream.writable.getWriter()}catch(e){return new tb("VideoFrameCaptureStream",tE.StreamCreationFailed,e.message,!0)}},t.start=function(e){this.active?console.warn("[VideoFrameCaptureStream]: Start called, but already capturing"):(this.startRVFC(e),this.active=!0)},t.stop=function(){var e;this.active=!1,null==(e=this.stopCapture)||e.call(this)},t.stats=function(){return this.captureStats},t.resetStats=function(){this.captureStats={captured:0,missed:0,blocked:0,rVFCDelay:0}},t.getStream=function(){return this.frameStream.readable},t.startRVFC=function(e){var t,n,r=this,i=void 0,a=-1;null==(n=this.stopCapture)||n.call(this),this.stopCapture=function(){return e.cancelVideoFrameCallback(a)};var o=(t=eg()(eS().mark(function t(n,s){var u,c,d;return eS().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r.active){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,performance.mark("Frame "+s.presentedFrames+" rVFC"),c=performance.now(),r.captureStats.rVFCDelay+=c-n,(d=new VideoFrame(e)).createdTimestamp=performance.now(),d.receivedTimestamp=n,d.number=s.presentedFrames,!((null!=(u=r.frameWriter.desiredSize)?u:0)<1)){t.next=16;break}return r.captureStats.blocked++,t.next=14,r.frameWriter.write(d);case 14:t.next=17;break;case 16:r.frameWriter.write(d);case 17:void 0===i?i=s.presentedFrames:s.presentedFrames-i>1&&(r.captureStats.missed+=s.presentedFrames-i),i=s.presentedFrames,r.captureStats.captured++,a=e.requestVideoFrameCallback(o),t.next=27;break;case 23:t.prev=23,t.t0=t.catch(2),console.warn("[VideoFrameCaptureStream]: Error encountered capturing frame.",t.t0),r.errorHandler(t.t0);case 27:case"end":return t.stop()}},t,null,[[2,23]])})),function(e,n){return t.apply(this,arguments)});console.log("[VideoFrameCaptureStream]: Started",e),a=e.requestVideoFrameCallback(o)},t.errorHandler=function(e){this.stop(),this.onError(e)},e}(),tP=function(){function e(e){this.windowContext=e,this.adapter=void 0,this.adapterInfo=void 0,this.device=void 0,this.queue=void 0,this.timingInfoEnabled=void 0}var t,n,r,i,a=e.prototype;return a.init=(t=eg()(eS().mark(function e(t){var n,r,i,a,o;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t&&(t=!1),this.windowContext.navigator.gpu){e.next=3;break}return e.abrupt("return",new tb("WebGPUContext",tE.WebGPUNotAvailable,"WebGPU not available",!0));case 3:return e.next=5,this.windowContext.navigator.gpu.requestAdapter({});case 5:if(n=e.sent){e.next=8;break}return e.abrupt("return",new tb("WebGPUContext",tE.WebGPUAdapterNotAvailable,"WebGPU Adapter not available",!0));case 8:return e.next=10,n.requestAdapterInfo();case 10:return r=e.sent,i=[],a={},"bgra8unorm"===this.windowContext.navigator.gpu.getPreferredCanvasFormat()&&n.features.has("bgra8unorm-storage")&&i.push("bgra8unorm-storage"),(t=t&&n.features.has("timestamp-query"))&&i.push("timestamp-query"),n.features.has("shader-f16")&&i.push("shader-f16"),a.requiredFeatures=i,e.next=20,this.tryGetDevice(n,a);case 20:if(o=e.sent){e.next=23;break}return e.abrupt("return",new tb("WebGPUContext",tE.WebGPUDeviceNotAvailable,"WebGPU Device not available",!0));case 23:this.adapterInfo=r,this.timingInfoEnabled=t,this.adapter=n,this.device=o,this.queue=o.queue,console.info("[WebGPUContext]: WebGPU context initialized",this.properties());case 29:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)}),a.properties=function(){if(!this.adapterInfo)return{architecture:"",description:"",device:"",vendor:"",adapterFeatures:"",deviceFeatures:""};var e="";this.adapter.features.forEach(function(t){e+=t+","});var t="";return this.device.features.forEach(function(e){t+=e+","}),{architecture:this.adapterInfo.architecture,description:this.adapterInfo.description,device:this.adapterInfo.device,vendor:this.adapterInfo.vendor,adapterFeatures:e,deviceFeatures:t}},a.createBuffer=function(e,t){return this.device.pushErrorScope("out-of-memory"),this.device.createBuffer({size:e,usage:t})},a.setBufferData=(n=eg()(eS().mark(function e(t,n,r){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),this.device.queue.writeBuffer(t,0,n),!r){e.next=5;break}return e.next=5,this.device.queue.onSubmittedWorkDone();case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)}),a.createShaderModule=(r=eg()(eS().mark(function e(t){var n,r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.device.createShaderModule({code:t}),e.next=3,n.getCompilationInfo();case 3:if(!((r=e.sent).messages.length>0)){e.next=7;break}return console.error("Error compiling shader",r.messages),e.abrupt("return",{err:new tb("WebGPUContext",tE.ShaderCompilationFailed,"Compilation failed: "+r.messages.join(),!0)});case 7:return e.abrupt("return",{module:n});case 8:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),a.tryGetDevice=(i=eg()(eS().mark(function e(t,n){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.requestDevice(n);case 3:case 11:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,t.requestDevice(null);case 14:return e.prev=14,e.t1=e.catch(8),e.abrupt("return",void 0);case 17:case"end":return e.stop()}},e,null,[[0,6],[8,14]])})),function(e,t){return i.apply(this,arguments)}),e}(),tw=function(){function e(e){this.onError=e,this.canvas=void 0,this.device=void 0,this.canvasContext=void 0,this.pipeline=void 0,this.externalPipeline=void 0,this.sampler=void 0}var t,n,r,i,a,o=e.prototype;return o.init=(t=eg()(eS().mark(function e(t,n){var r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.device=n,this.device.pushErrorScope("validation"),this.sampler=this.device.createSampler({magFilter:"linear",minFilter:"linear"}),e.next=5,this.device.popErrorScope();case 5:if(!(r=e.sent)){e.next=8;break}return e.abrupt("return",new tb("CanvasSink",tE.SamplerCreationFailed,r.message,!0));case 8:e.prev=8,this.setCanvas(t.transferControlToOffscreen()),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(8),e.abrupt("return",new tb("CanvasSink",tE.CanvasCreationFailed,e.t0.message,!0));case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}},e,this,[[8,12]])})),function(e,n){return t.apply(this,arguments)}),o.render=(n=eg()(eS().mark(function e(t){var n,r,i,a,o,s,u,c,d,l,h,f,v,p;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvasContext){e.next=2;break}return e.abrupt("return",new tb("CanvasSink",tE.Render,"Failed to get WebGPU Canvas context",!0));case 2:if(!(t instanceof VideoFrame)){e.next=21;break}if(i=this.device.importExternalTexture({source:t}),this.externalPipeline){e.next=16;break}return e.next=7,this.makePipeline(this.canvas.width,this.canvas.height,!0);case 7:if(o=(a=e.sent).pipeline,!(s=a.error)&&o){e.next=12;break}return e.abrupt("return",s);case 12:n=o,this.externalPipeline=n,e.next=17;break;case 16:n=this.externalPipeline;case 17:u=n.getBindGroupLayout(0),r=this.device.createBindGroup({layout:u,entries:[{binding:0,resource:this.canvasContext.getCurrentTexture().createView()},{binding:1,resource:this.sampler},{binding:2,resource:i}]}),e.next=37;break;case 21:if(c=t,this.pipeline){e.next=34;break}return e.next=25,this.makePipeline(this.canvas.width,this.canvas.height,!1);case 25:if(l=(d=e.sent).pipeline,!(h=d.error)&&l){e.next=30;break}return e.abrupt("return",h);case 30:n=l,this.pipeline=n,e.next=35;break;case 34:n=this.pipeline;case 35:f=n.getBindGroupLayout(0),r=this.device.createBindGroup({layout:f,entries:[{binding:0,resource:this.canvasContext.getCurrentTexture().createView()},{binding:1,resource:this.sampler},{binding:2,resource:c.createView()}]});case 37:this.device.pushErrorScope("validation"),(p=(v=this.device.createCommandEncoder()).beginComputePass()).setPipeline(n),p.setBindGroup(0,r),p.dispatchWorkgroups(Math.ceil(this.canvas.width/16),Math.ceil(this.canvas.height/16),1),p.end(),this.device.queue.submit([v.finish()]),this.checkForErrorsAsync();case 46:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)}),o.setDimensions=function(e,t){e==this.canvas.width&&t==this.canvas.height||(this.canvas.width=e,this.canvas.height=t,this.pipeline=void 0,this.externalPipeline=void 0)},o.surface=function(){return this.canvas},o.setCanvas=(r=eg()(eS().mark(function e(t){var n,r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,this.canvasContext=t.getContext("webgpu"),this.canvasContext){e.next=4;break}return e.abrupt("return",new tb("CanvasSink",tE.Render,"Failed to get WebGPU Canvas context",!0));case 4:return n=navigator.gpu.getPreferredCanvasFormat(),r={device:this.device,format:n,usage:GPUTextureUsage.STORAGE_BINDING,viewFormats:[n],alphaMode:"opaque"},this.device.pushErrorScope("validation"),this.canvasContext.configure(r),e.next=10,this.device.popErrorScope();case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",new tb("CanvasSink",tE.Render,"Failed to configure Canvas context",!0));case 13:return e.abrupt("return",void 0);case 14:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),o.makePipeline=(i=eg()(eS().mark(function e(t,n,r){var i,a,o,s,u,c;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.getShader(t,n,r),e.next=3,this.createShaderModule(i);case 3:if(o=(a=e.sent).module,s=a.error,o&&!s){e.next=8;break}return e.abrupt("return",{error:s});case 8:return this.device.pushErrorScope("validation"),u=this.device.createComputePipeline({layout:"auto",compute:{module:o,entryPoint:"main"},label:"canvas-sink"}),e.next=12,this.device.popErrorScope();case 12:if(!(c=e.sent)){e.next=15;break}return e.abrupt("return",{error:new tb("CanvasSink",tE.PipelineCreationFailed,""+c.message,!0)});case 15:return e.abrupt("return",{pipeline:u});case 16:case"end":return e.stop()}},e,this)})),function(e,t,n){return i.apply(this,arguments)}),o.createShaderModule=(a=eg()(eS().mark(function e(t){var n,r;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.device.createShaderModule({code:t}),e.next=3,n.getCompilationInfo();case 3:if(!((r=e.sent).messages.length>0)){e.next=7;break}return console.error("Error compiling shader",r.messages),e.abrupt("return",{error:new tb("CanvasSink",tE.ShaderCompilationFailed,"Shader compilation failed: "+r.messages.join(),!0)});case 7:return e.abrupt("return",{module:n});case 8:case"end":return e.stop()}},e,this)})),function(e){return a.apply(this,arguments)}),o.getShader=function(e,t,n){return"\n        @group(0) @binding(0) var outputTexture: texture_storage_2d<"+navigator.gpu.getPreferredCanvasFormat()+", write>;\n        @group(0) @binding(1) var inputSampler: sampler;\n        @group(0) @binding(2) var inputTexture: "+(n?"texture_external":"texture_2d<f32>")+";\n\n        @compute @workgroup_size(16,16,1)\n        fn main(@builtin(global_invocation_id) global_id : vec3<u32>) {\n            let size = vec2<f32>("+e+", "+t+");\n            let pos = vec2<f32>(f32(global_id.x), f32(global_id.y)) / size;\n            let color = textureSampleBaseClampToEdge(inputTexture, inputSampler, pos);\n            textureStore(outputTexture, global_id.xy, color);\n        }\n        "},o.checkForErrorsAsync=function(){var e=this;this.device.popErrorScope().then(function(t){t&&(console.warn("[CanvasSink]: WebGPU error encountered",t),e.onErrorInternal(new tb("CanvasSink",tE.Render,"Failed to render: "+t.message,!0)))})},o.onErrorInternal=function(e){this.onError(e)},e}(),tA=function(e){var t;function n(){return e.call(this,"PassthroughTransformer")||this}return eT()(n,e),n.prototype.transform=(t=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),n}(function(){function e(e){this.name=e}var t,n,r,i,a,o=e.prototype;return o.init=(t=eg()(eS().mark(function e(){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),function(){return t.apply(this,arguments)}),o.transform=(n=eg()(eS().mark(function e(t,n){var r,i,a=this;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=performance.now(),e.next=3,Promise.race([this.doTransform(t),this.frameBudgetExceededPassthrough(n)]).catch(function(e){return console.warn("["+a.name+"]: Error encountered during frame transform",e),{frame:t,success:!1,time:r-performance.now(),error:e}});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)}),o.doTransform=(r=eg()(eS().mark(function e(t){var n;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transformFn(t);case 2:return n=e.sent,e.abrupt("return",{texture:n});case 4:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),o.frameBudgetExceededPassthrough=(i=eg()(eS().mark(function e(t){var n=this;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){return setTimeout(function(){console.warn("["+n.name+"]: Frame budget of "+t+"ms exceeded"),e({})},t)}));case 1:case"end":return e.stop()}},e)})),function(e){return i.apply(this,arguments)}),o.transformFn=(a=eg()(eS().mark(function e(t){return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)}),e}()),tD=function(){function e(e,t,n){this.windowContext=e,this.listeners=n,this.canvas=void 0,this.sourceVideo=void 0,this.pipeline=void 0,this.frameStream=void 0,this.gpuContext=void 0,this.config=void 0,this.config={pipeline:I()({},{minimumFramerate:60,includeReceiveDelay:!0},t.pipeline),capture:I()({},{maxQueueSize:2},t.capture)},console.log("[VideoTransformer]: Provided config",t,"Parsed config",this.config),this.canvas=e.document.createElement("canvas")}var t,n=e.prototype;return n.init=(t=eg()(eS().mark(function e(){var t,n,r,i,a,o,s,u;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=performance.now(),console.log("[VideoTransformer]: Init start"),n=this.onErrorInternal.bind(this),e.prev=3,r=this.gpuContext=new tP(this.windowContext),e.next=7,r.init(!0);case 7:if(!(i=e.sent)){e.next=10;break}return e.abrupt("return",{err:i});case 10:return a=new tw(n),e.next=13,a.init(this.canvas,r.device);case 13:if(!(o=e.sent)){e.next=16;break}return e.abrupt("return",{err:o});case 16:if(this.frameStream=new tT(this.config.capture,n),!(s=this.frameStream.init())){e.next=20;break}return e.abrupt("return",{err:s});case 20:return this.pipeline=new tC(this.frameStream.getStream(),a,n,this.config.pipeline),e.next=23,this.pipeline.init(new tA);case 23:if(!(u=e.sent)){e.next=26;break}return e.abrupt("return",{err:u});case 26:return console.log("[VideoTransformer]: Init complete in "+(performance.now()-t).toFixed(3)+"ms"),e.abrupt("return",{info:{timeMs:performance.now()-t,gpuProperties:r.properties()}});case 30:return e.prev=30,e.t0=e.catch(3),console.warn("[VideoTransformer]: Failed to init",e.t0),e.abrupt("return",{err:new tb("VideoTransformer",tE.Init,e.t0.message,!0)});case 34:case"end":return e.stop()}},e,this,[[3,30]])})),function(){return t.apply(this,arguments)}),n.start=function(e){this.frameStream?this.active()?console.warn("[VideoTransformer]: Start called on active instance"):(this.sourceVideo=e,this.frameStream.start(e),console.log("[VideoTransformer]: Pipeline started")):console.warn("[VideoTransformer]: Start called before init")},n.stop=function(){var e;console.log("[VideoTransformer]: Stopping render pipeline"),null==(e=this.frameStream)||e.stop()},n.active=function(){var e,t;return null!=(e=null==(t=this.frameStream)?void 0:t.active)&&e},n.stats=function(){if(!this.pipeline||!this.frameStream)return{timestamp:performance.now(),frames:{source:0,captured:0,transformed:0,rendered:0,missed:0,blocked:0,skipped:0,failed:0,overBudget:0},timings:{captureDelay:0,receiveDelay:0,transformTime:0,renderTime:0,endToEnd:0}};var e,t,n=this.pipeline.stats(),r=(n.received,n.transformTime),i=n.skipped,a=n.transformed,o=n.failed,s=n.overBudget,u=n.rendered,c=(n.totalProcessingTime,n.renderTime),d=n.receiveDelay,l=n.endToEnd,h=this.frameStream.stats(),f=h.captured,v=h.blocked,p=h.missed,m=h.rVFCDelay,g=null!=(e=null==(t=this.sourceVideo)?void 0:t.getVideoPlaybackQuality())?e:{totalVideoFrames:0,droppedVideoFrames:0};return{timestamp:performance.now(),frames:{source:g.totalVideoFrames-g.droppedVideoFrames,captured:f,transformed:a,rendered:u,missed:p,blocked:v,skipped:i,failed:o,overBudget:s},timings:{captureDelay:m,receiveDelay:d,transformTime:r,renderTime:c,endToEnd:l}}},n.renderSurface=function(){return this.canvas},n.gpuProperties=function(){var e;return null==(e=this.gpuContext)?void 0:e.properties()},n.reset=function(){var e,t;null==(e=this.frameStream)||e.resetStats(),null==(t=this.pipeline)||t.resetStats()},n.onErrorInternal=function(e){this.stop(),this.listeners.error(e)},e}(),tM=function(e){return e.setAttribute("playsinline",""),{element:function(){return e},displayDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},videoDimensions:function(){return{width:e.videoWidth,height:e.videoHeight}},stats:function(){return{timestamp:performance.now(),droppedFrames:m(e),decodedFrames:p(e)}},visible:function(){return f(e)}}},tL=function(e,t){var n=e,r=t,i=0;return{update:function(e,t){t!==r&&(i=(e-n)/(t-r)*1e3,n=e,r=t)},framerate:function(){return i}}},t_=function(){function e(e,t){this.initialConfig=e,this.listeners=t,this.videoTransformer=void 0,this.surface=void 0,this.statusInterval=void 0,this.source=void 0,this.config=void 0,this.disabled=!1,this.config=I()({},{statusIntervalMs:5e3},e.module)}var t,n=e.prototype;return n.init=(t=eg()(eS().mark(function e(){var t,n,r,i;return eS().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoTransformer){e.next=3;break}return console.log("[VideoTransformerModule]: Init called on setup instance"),e.abrupt("return",void 0);case 3:return r=this.videoTransformer=new tD(window,null!=(t=null==(n=this.initialConfig.module)?void 0:n.transformer)?t:{},{error:this.onTransformerError.bind(this)}),e.next=6,r.init();case 6:if(!(i=e.sent).err){e.next=10;break}return this.onTransformerError(i.err),e.abrupt("return",void 0);case 10:return this.surface=this.createWebGpuCanvasSurface(r.renderSurface()),this.logInitEvent(i),e.abrupt("return",this.surface);case 13:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)}),n.start=function(e){this.videoTransformer?this.disabled?console.log("[VideoTransformerModule]: start called, but module is disabled"):(this.source=e,console.log("[VideoTransformerModule]: Starting"),this.videoTransformer.start(e),this.videoTransformer.active()?this.logStatusEvent(this.config.statusIntervalMs,this.videoTransformer.stats()):console.log("[VideoTransformerModule]: Failed to start")):console.log("[VideoTransformerModule]: Start called before init")},n.stop=function(){var e;null==(e=this.videoTransformer)||e.stop(),clearInterval(this.statusInterval)},n.active=function(){var e,t;return null!=(e=null==(t=this.videoTransformer)?void 0:t.active())&&e},n.stats=function(){var e,t,n=0,r=0,i=performance.now(),a=null==(e=this.videoTransformer)?void 0:e.stats().frames;return a?(n=null!=(t=a.rendered)?t:0,{timestamp:i,droppedFrames:r=a.missed+a.skipped+a.failed,decodedFrames:n}):{timestamp:i,decodedFrames:n,droppedFrames:r}},n.reset=function(){var e;null==(e=this.videoTransformer)||e.reset()},n.swapVideoSource=function(e){var t;null!=(t=this.videoTransformer)&&t.active()&&(this.videoTransformer.stop(),this.videoTransformer.start(e))},n.createWebGpuCanvasSurface=function(e){var t=(e.style.objectFit="contain",e.style.overflowClipMargin="content-box",e.style.overflow="clip",{element:function(){return e},displayDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},videoDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},stats:function(){return{timestamp:performance.now(),droppedFrames:0,decodedFrames:0}},visible:function(){return f(e)}});return t.stats=this.stats.bind(this),t},n.logStatusEvent=function(e,t){var n,r=this,i=tL(t.frames.source,t.timestamp),a=tL(t.frames.captured,t.timestamp),o=tL(t.frames.rendered,t.timestamp),s=function(){if(r.videoTransformer){var t,n,s,u=r.videoTransformer.stats(),c=u.frames,d=u.timings,l=u.timestamp;i.update(c.source,l),a.update(c.captured,l),o.update(c.rendered,l),r.printStats(u,i.framerate(),a.framerate(),o.framerate());var h=I()({status_timestamp:l,status_interval:e,surface_visible:null!=(t=null==(n=r.surface)?void 0:n.visible())&&t,frames_source:c.source,frames_captured:c.captured,frames_missed:c.missed,frames_blocked:c.blocked,frames_skipped:c.skipped,frames_transformed:c.transformed,frames_rendered:c.rendered,frames_failed:c.failed,framerate_source:i.framerate(),framerate_capture:a.framerate(),framerate_render:o.framerate(),time_capture_delay:d.captureDelay,time_receive_delay:d.receiveDelay,time_transform:d.transformTime,time_render:d.renderTime,time_end_to_end:d.endToEnd},r.gpuAnalyticsProperties());r.listeners.analytics({name:"onGpuStatus",data:h})}else clearInterval(null!=(s=r.statusInterval)?s:-1)};s(),clearInterval(null!=(n=this.statusInterval)?n:-1),this.statusInterval=setInterval(s,e)},n.logInitEvent=function(e){if(e.info){var t=e.info,n=t.timeMs,r=t.gpuProperties,i=I()({gpu_time_init:n,gpu_adapter_features:r.adapterFeatures,gpu_device_features:r.deviceFeatures,gpu_transformer_config:JSON.stringify(this.initialConfig)},this.gpuAnalyticsProperties());this.listeners.analytics({name:"onGpuInit",data:i})}},n.onTransformerError=function(e){this.stop();var t=I()({code:e.code,source:e.source,message:e.message,fatal:!0},this.gpuAnalyticsProperties());console.warn("[VideoTransformerModule]: Error, disabling module",e),this.disabled=!0,this.listeners.error(t),this.listeners.analytics({name:"onGpuError",data:t})},n.gpuAnalyticsProperties=function(){var e,t,n,r,i,a=null==(e=this.videoTransformer)?void 0:e.gpuProperties();return{gpu_architecture:null!=(t=null==a?void 0:a.architecture)?t:"",gpu_description:null!=(n=null==a?void 0:a.description)?n:"",gpu_device:null!=(r=null==a?void 0:a.device)?r:"",gpu_vendor:null!=(i=null==a?void 0:a.vendor)?i:""}},n.printStats=function(e,t,n,r){var i,a,o=e.frames,s=o.source,u=o.captured,c=o.transformed,d=o.rendered,l=o.missed,h=o.blocked,f=o.skipped,v=o.failed,p=o.overBudget,m=e.timings,g=m.captureDelay,y=m.receiveDelay,S=m.transformTime/u,k=m.renderTime/d,b=m.endToEnd/d;console.log("[VideoTransformerModule]: "+("Stats:\nSurface visible:                       "+(null!=(i=null==(a=this.surface)?void 0:a.visible())&&i)+"\nStats Interval:                        "+this.config.statusIntervalMs+"ms\nSource Framerate:                      "+t.toFixed(1)+"\nCapture Framerate:                     "+n.toFixed(1)+"\nRender Framerate:                      "+r.toFixed(1)+"\nSource frames:                         "+s+"\nCaptured frames:                       "+u+"\nTransformed frames:                    "+c+"\nRendered frames:                       "+d+"\nMissed frames:                         "+l+"\nBlocked frames:                        "+h+"\nSkipped frames:                        "+f+"\nOverbudget frames:                     "+p+"\nFailed frames:                         "+v+"\nAverage rVFC capture delay:            "+(g/u).toFixed(3)+"ms\nAverage frame receive delay:           "+(y/u).toFixed(3)+"ms\nAverage frame transform time:          "+S.toFixed(3)+"ms\nAverage frame render time:             "+k.toFixed(3)+"ms\nAverage frame end-to-end time:         ")+b.toFixed(3)+"ms\n")},e}(),tR=((tX={}).video="video",tX.canvas="canvas",tX.debug_both="debug_both",tX),tI=function(){function e(e){this.context=e,this.video=void 0,this.canvas=void 0,this.surfaceContainer=void 0,this.lastVisibleDroppedFrames=0,this.ignoredDroppedFrames=0,this.framerateTracker=void 0,this.surfaceContainer=e.createElement("div");var t=e.createElement("video");this.video=tM(t);var n=this.video.stats();this.framerateTracker=tL(n.decodedFrames,n.timestamp)}var t=e.prototype;return t.setVideo=function(e){if(this.video.element()!==e){this.activeSurface()!==tR.video&&this.hideSurface(e),this.ignoredDroppedFrames=0,this.lastVisibleDroppedFrames=0;var t=tM(e),n=t.stats();this.framerateTracker=tL(n.decodedFrames,n.timestamp),this.video=t}},t.moveVideoToRenderSurface=function(){this.replaceElement(tR.video,this.video.element())},t.setCanvas=function(e){this.canvas!==e&&(this.activeSurface()!==tR.canvas&&this.hideSurface(e.element()),this.replaceElement(tR.canvas,e.element()),this.canvas=e)},t.setActiveSurface=function(e){if(e!==this.activeSurface()){var t,n,r;if(e===tR.canvas){if(!this.canvas)return void console.warn("[RenderSurface]: Tried to set canvas surface to active, but the canvas surface is undefiend.");this.lastVisibleDroppedFrames=this.video.stats().droppedFrames-this.ignoredDroppedFrames,this.hideSurface(this.video.element()),this.showSurface(this.canvas.element())}else e===tR.video?(this.hideSurface(null==(t=this.canvas)?void 0:t.element()),this.showSurface(this.video.element()),this.ignoredDroppedFrames=this.video.stats().droppedFrames-(null!=(n=this.lastVisibleDroppedFrames)?n:0)):e===tR.debug_both&&(this.showSurface(null==(r=this.canvas)?void 0:r.element()),this.showSurface(this.video.element()))}},t.surface=function(){return this.surfaceContainer},t.videoElement=function(){return this.video.element()},t.displayDimensions=function(){return this.video.displayDimensions()},t.videoDimensions=function(){return this.video.videoDimensions()},t.stats=function(){var e,t=this.video.stats(),n=t.droppedFrames-this.ignoredDroppedFrames;return this.activeSurface()!==tR.video&&(n=null!=(e=this.lastVisibleDroppedFrames)?e:0),this.framerateTracker.update(t.decodedFrames,t.timestamp),I()({},t,{droppedFrames:n})},t.framerate=function(){return this.framerateTracker.framerate()},t.activeSurface=function(){var e;return null!=(e=this.canvas)&&e.visible()?tR.canvas:tR.video},t.safeAppendSurface=function(e){try{this.surfaceContainer.appendChild(e)}catch(e){console.warn("[RenderSurface]: Failed to append surface to container",e)}},t.safeRemoveSurface=function(e){try{var t=this.surfaceContainer.querySelector(e);t&&this.surfaceContainer.removeChild(t)}catch(e){console.warn("[RenderSurface]: Failed to remove surface from container",e)}},t.replaceElement=function(e,t){this.safeRemoveSurface(e),this.safeAppendSurface(t)},t.hideSurface=function(e){e&&(e.style.visibility="hidden",e.style.position="absolute",e.style.inset="0")},t.showSurface=function(e){e&&(e.style.visibility="inherit",e.style.position="inherit",e.style.inset="inherit")},e}(),tx=function(){function e(t,n){var r,i,a,o=this;this.worker=void 0,this.id=void 0,this.emitter=new eU,this.seekTime=null,this.paused=!0,this.isLoaded=!1,this.autoPlayOptions=null,this.mediaSinkManager=void 0,this.experiments={},this.adjustments=void 0,this.enableRemoteSearch=void 0,this.isQualitySupported=void 0,this.onvisibilitychange=void 0,this.onmessage=function(e){return o.onWorkerMessage(e)},this.onOnline=function(){return o.postMessage("onOnline")},this.onOffline=function(){return o.postMessage("onOffline")},this.pauseHiddenSilentTab=void 0,this.state=void 0,this.workerMessageProcessors=[N],this.configManager=void 0,this.videoTransformerModule=void 0,this.renderSurface=new tI(document),this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,this.worker=n,this.id=e.instanceId++,this.isQualitySupported=t.isQualitySupported||c,this.onvisibilitychange=function(){return o.onVisibilityChange()},this.enableRemoteSearch=t.enableRemoteSearch||!1;var s,u,d=_();if(this.pauseHiddenSilentTab=d.chrome&&63===d.major||d.opera,this.adjustments=(s=null!=(i=null==(a=t.webviewHost)?void 0:a.adjustments)?i:{},I()({},tf,s)),this.mediaSinkManager=new tl(this,this.enableRemoteSearch,this.adjustments,this.renderSurface.videoElement()),F.isSupported()){var l=new F;this.workerMessageProcessors.push(l.processor)}void 0!==t.serviceWorker&&("serviceWorker"in navigator||(e6.warn("Service workers are not supported."),0))&&(e8=e7(t.serviceWorker),null==(u=e5())||u.registerAndActivate()),this.state={averageBitrate:0,bandwidthEstimate:0,looping:!1,autoQualityMode:!0,volume:1,liveLatency:0,liveLowLatencyEnabled:!0,liveLowLatency:!1,statistics:{}},this.resetState(),this.attachHandlers(),this.checkDebugCaptureEnabled();var h,f=[];h='video/mp4; codecs="hvc1.1.40000000.L60.80.0.0.0.0.0"',(U()?MediaSource.isTypeSupported(h):""!==document.createElement("video").canPlayType(h))&&f.push("hevc"),r='video/mp4; codecs="av01.0.05M.08"',(U()?MediaSource.isTypeSupported(r):""!==document.createElement("video").canPlayType(r))&&f.push("av01"),this.configManager=new tm({},this.onConfigChanged.bind(this)),this.onConfigChanged(),this.postMessage("create",[{mseSupported:U(),keySystem:void 0!==t.keySystem?t.keySystem:window.WebKitMediaKeys&&"function"==typeof window.WebKitMediaKeys.isTypeSupported&&window.WebKitMediaKeys.isTypeSupported(q.FAIRPLAY.keySystem)?q.FAIRPLAY.uuid:"function"==typeof navigator.requestMediaKeySystemAccess?d.safari?"":d.msIE||d.msEdgeLegacy?q.PLAYREADY.uuid:q.WIDEVINE.uuid:"",browserContext:I()({},d,{webviewHost:t.webviewHost}),codecs:f,testOnly:t.testOnly,playerFramework:t.playerFramework,buildDistId:"npm"},this.configManager.getConfigSnapshot()])}var t=e.prototype;return t.delete=function(){var e,t=this;null==(e=e5())||e.destroy();var n=d(document).visibilityChange;document.removeEventListener(n,this.onvisibilitychange),window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline),this.emitter.removeAllListeners(),this.emitter.on(th.DESTROY,function(){t.mediaSinkManager.destroy(),t.emitter.removeAllListeners(),t.worker.removeEventListener("message",t.onmessage)}),this.configManager.delete(),this.postMessage("delete")},t.attachHTMLVideoElement=function(e){var t,n;null==(t=this.mediaSinkManager)||t.destroy(),this.mediaSinkManager=new tl(this,this.enableRemoteSearch,this.adjustments,e),this.processVideoElementAttributes(e),this.renderSurface.setVideo(e),null==(n=this.videoTransformerModule)||n.swapVideoSource(e),this.configManager.getConfigSnapshot().features.gpu.flags.enable_render_surface&&this.renderSurface.moveVideoToRenderSurface()},t.getHTMLVideoElement=function(){return this.renderSurface.videoElement()},t.getVideoRenderSurface=function(){if(this.configManager.getConfigSnapshot().features.gpu.flags.enable_render_surface)return this.renderSurface.surface();console.log("[MediaPlayerCore]:getVideoRenderSurfce called without first enabling renderSurface usage")},t.load=function(e,t){var n;void 0===t&&(t=""),null==(n=e5())||n.configure(),this.postMessage("load",[e,t]),this.autoPlayOptions&&this.postMessage("playIntent")},t.play=function(){this.postMessage("playIntent"),this.mediaSinkManager.captureGesture(),this.paused=!1,this.attemptPlay()},t.setAutoplay=function(e){this.autoPlayOptions=e?{attemptMutedRetry:!0}:null},t.setAutoPlayOptions=function(e){this.autoPlayOptions=e},t.getExperiments=function(){return this.experiments},t.setExperiment=function(e,t){this.setExperimentData({id:e,assignment:t,version:0,type:""})},t.setExperimentData=function(e){this.configManager.setExperiment(e.id,e.assignment),this.postMessage("setExperiment",[e])},t.pause=function(){this.paused=!0,this.postMessage("pause")},t.isPaused=function(){return this.paused},t.seekTo=function(e){this.seekTime=e,this.postMessage("seekTo",[e])},t.isSeeking=function(){return null!==this.seekTime},t.isAutoplay=function(){return!!this.autoPlayOptions},t.getDuration=function(){return this.state.duration},t.getStartOffset=function(){return this.state.startOffset||0},t.getPosition=function(){return null===this.seekTime?this.mediaSinkManager.getCurrentSink().getCurrentTime():this.seekTime},t.getSyncTime=function(){return this.state.syncTime},t.getBuffered=function(){return this.mediaSinkManager.getCurrentSink().buffered()},t.getBufferedRanges=function(){return this.postMessage("updateBufferedRanges",[]),this.state.trackBufferedRanges},t.getSinkBufferedRanges=function(){var e=this.mediaSinkManager.getCurrentSink();return{audio:e.getBufferedRanges("audio"),video:e.getBufferedRanges("video")}},t.getBufferDuration=function(){return this.state.bufferedPosition-this.getPosition()},t.getState=function(){return this.state.state},t.getVideoWidth=function(){return this.getHTMLVideoElement().videoWidth},t.getVideoHeight=function(){return this.getHTMLVideoElement().videoHeight},t.getVideoFrameRate=function(){return this.state.statistics.framerate},t.getVideoBitRate=function(){return this.state.statistics.bitrate},t.getAverageBitrate=function(){return this.state.averageBitrate},t.getBandwidthEstimate=function(){return this.state.bandwidthEstimate},t.getPath=function(){return this.state.path},t.getProtocol=function(){return this.state.protocol},t.getVersion=function(){return"1.29.0"},t.isLiveLowLatency=function(){return this.state.liveLowLatencyEnabled&&this.state.liveLowLatency},t.isLooping=function(){return this.state.looping},t.setLogLevel=function(e){(function(e){var t,n={debug:!1,log:!1,info:!1,warn:!1,error:!1},r=function(e,t){for(var r,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return eW(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?eW(e,void 0):void 0}}(e))){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(r=i()).done;)n[r.value]=t};switch(e.level){case"debug":r(["debug","log","info","warn","error"],!0);break;case"log":r(["log","info","warn","error"],!0);break;case"info":r(["info","warn","error"],!0);break;case"warn":r(["warn","error"],!0);break;case"error":r(["error"],!0)}t={enabled:e.enabled,levels:n},ej.enabled=t.enabled,ej.levels=I()({},t.levels),eq.emit("logConfigUpdated",t)})({enabled:!0,level:e}),this.postMessage("setLogLevel",[e])},t.setLooping=function(e){this.state.looping=e,this.postMessage("setLooping",[e])},t.isMuted=function(){return this.mediaSinkManager.getCurrentSink().isMuted()},t.setMuted=function(e){this.mediaSinkManager.getCurrentSink().setMuted(e)},t.setVolume=function(e){this.state.volume=e,this.postMessage("setVolume",[this.state.volume])},t.getVolume=function(){return this.state.volume},t.getQuality=function(){return this.state.quality},t.setQuality=function(e,t){void 0===t&&(t=!1),this.getHTMLVideoElement().controls||(this.postMessage("setQuality",[e,t]),this.state.autoQualityMode=!1)},t.getQualities=function(){return this.state.qualities},t.setAuthToken=function(e){this.postMessage("setAuthToken",[e])},t.isAutoQualityMode=function(){return this.state.autoQualityMode},t.setAutoQualityMode=function(e){this.state.autoQualityMode=e,this.postMessage("setAutoQualityMode",[e])},t.setAutoInitialBitrate=function(e){this.postMessage("setAutoInitialBitrate",[e])},t.setAutoMaxQuality=function(e){this.postMessage("setAutoMaxQuality",[e])},t.setAutoMaxBitrate=function(e){this.postMessage("setAutoMaxBitrate",[e])},t.setAutoMaxVideoSize=function(e,t){this.postMessage("setAutoMaxVideoSize",[e,t])},t.setAutoViewportSize=function(e,t){this.postMessage("setAutoViewportSize",[e,t])},t.getPlaybackRate=function(){return this.mediaSinkManager.getCurrentSink().getPlaybackRate()},t.setPlaybackRate=function(e){return this.mediaSinkManager.getCurrentSink().setPlaybackRate(e)},t.setClientId=function(e){this.postMessage("setClientId",[e])},t.setDeviceId=function(e){this.postMessage("setDeviceId",[e])},t.setLiveSpeedUpRate=function(e){this.postMessage("setLiveSpeedUpRate",[e])},t.setPlayerType=function(e){this.postMessage("setPlayerType",[e])},t.setLiveMaxLatency=function(e){this.postMessage("setLiveMaxLatency",[e])},t.setLiveLowLatencyEnabled=function(e){this.state.liveLowLatencyEnabled=e,this.postMessage("setLiveLowLatencyEnabled",[e])},t.setRebufferToLive=function(e){var t;null!=(t=e5())&&null!=(t=t.getDriftDetectionConfig())&&t.enabled||this.postMessage("setRebufferToLive",[e])},t.setVisible=function(e){this.postMessage("setVisible",[e])},t.setInitialBufferDuration=function(e){this.postMessage("setInitialBufferDuration",[e])},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.removeListener(e,t)},t.getDroppedFrames=function(){return this.state.statistics.droppedFrames},t.getDecodedFrames=function(){return this.state.statistics.decodedFrames},t.getDisplayWidth=function(){return this.renderSurface.displayDimensions().width},t.getDisplayHeight=function(){return this.renderSurface.displayDimensions().height},t.getSessionId=function(){return this.state.sessionId},t.getChannelMetadata=function(){return this.state.channelMetadata},t.getSessionData=function(){return this.state.sessionData},t.getLiveLatency=function(){return this.state.liveLatency},t.isProtected=function(){return this.mediaSinkManager.isProtected()},t.startRemotePlayback=function(){this.postMessage("startRemotePlayback")},t.endRemotePlayback=function(){this.postMessage("endRemotePlayback")},t.setPlatformName=function(e){this.postMessage("setPlatformName",[e])},t.setRequestCredentials=function(e){this.postMessage("setRequestCredentials",[e])},t.setSinkType=function(e){this.postMessage("setSinkType",[e])},t.onSinkTimeUpdate=function(){if(null===this.seekTime){var e=this.mediaSinkManager.getCurrentSink(),t=this.renderSurface.stats(),n=t.droppedFrames,r=t.decodedFrames,i=this.renderSurface.displayDimensions(),a=i.height,o=i.width;this.postMessage("onClientSinkUpdate",[{currentTime:e.getCurrentTime(),decodedFrames:r,droppedFrames:n,framerate:this.renderSurface.framerate(),bufferDuration:e.bufferDuration(),displayHeight:a,displayWidth:o}]),this.setAutoViewportSize(o*window.devicePixelRatio,a*window.devicePixelRatio),this.emitter.emit(x.TIME_UPDATE,e.getCurrentTime())}},t.onSinkBufferUpdate=function(){this.emitter.emit(x.BUFFER_UPDATE)},t.onSinkDurationChanged=function(e){this.postMessage("onClientSinkDurationChanged",[e])},t.onSinkEnded=function(){this.postMessage("onClientSinkEnded")},t.onSinkIdle=function(){this.postMessage("onClientSinkIdle")},t.onSinkPlaying=function(e){this.postMessage("onClientSinkPlaying"),e&&this.play()},t.onSinkStop=function(e){var t,n,r=d(document).hidden;if(document[r])this.postMessage("pause");else if(e){if(!this.isMuted()&&(null==(t=null==(n=this.autoPlayOptions)?void 0:n.attemptMutedRetry)||t))return this.setMuted(!0),this.mediaSinkManager.getCurrentSink().play(),void this.emitter.emit(x.AUDIO_BLOCKED);this.pause(),this.emitter.emit(x.PLAYBACK_BLOCKED)}else this.pause()},t.onSinkReset=function(){this.postMessage("onClientSinkReset")},t.onSinkError=function(e){var t=e.value,n=e.code,r=e.message;this.postMessage("onClientSinkError",[t,n,r])},t.onSinkRecoverableError=function(e){var t=e.value,n=e.code,r=e.message;this.postMessage("onClientSinkRecoverableError",[t,n,r])},t.onSinkVolumeChanged=function(e,t){this.getHTMLVideoElement().controls&&t&&this.setVolume(e),this.emitter.emit(x.VOLUME_CHANGED,this.state.volume)},t.onSinkMutedChanged=function(e){this.postMessage("setMuted",[e]),this.emitter.emit(x.MUTED_CHANGED)},t.onSinkPlaybackRateChanged=function(e){this.postMessage("setPlaybackRate",[e])},t.onPassthroughSinkMetadata=function(e,t,n,r,i){this.emitter.emit(x.TEXT_METADATA_CUE,{description:r,endTime:t,startTime:e,text:n,owner:i,type:"TextMetadataCue"})},t.onPassthroughSinkPropertyChanged=function(e,t){this.postMessage("onClientSinkPassthroughPropertyChanged",[e,t])},t.onSinkControlsChanged=function(e){this.postMessage("setControls",[e])},t.onSinkGapJump=function(e){this.postMessage("onClientSinkGapJump",[e])},t.onRemoteDevice=function(e){this.emitter.emit(e?ev.AVAILABLE:ev.UNAVAILABLE)},t.onRemoteReconnect=function(){this.startRemotePlayback()},t.onSessionError=function(){this.postMessage("onClientSinkError",[1,0,"Chromecast session error"])},t.onLoadMediaError=function(){this.postMessage("onClientSinkError",[1,0,"Chromecast load media failed"])},t.onUserCancel=function(){this.endRemotePlayback(),this.emitter.emit(ev.SESSION_ENDED)},t.onSegmentDiscontinuity=function(){this.mediaSinkManager.onSegmentDiscontinuity()},t.onSessionStop=function(){this.endRemotePlayback(),this.emitter.emit(ev.SESSION_ENDED)},t.onSessionStarted=function(e){this.emitter.emit(ev.SESSION_STARTED,e)},t.attemptPlay=function(){var e=d(document).hidden;!document[e]&&this.isLoaded&&this.postMessage("play")},t.postMessage=function(e,t,n){void 0===n&&(n=[]),this.worker.postMessage({id:this.id,funcName:e,args:t},n)},t.resetState=function(){Object.assign(this.state,{state:ep.IDLE,quality:{name:"",group:"",codecs:"",bitrate:0,width:0,height:0,framerate:0},qualities:[],duration:0,startOffset:0,sessionData:{},volume:1,statistics:{bitrate:0,framerate:0,droppedFrames:0,decodeFrames:0,renderedFrames:0},trackBufferedRanges:{audio:[],video:[]},channelMetadata:[]}),this.emitter.emit(x.DURATION_CHANGED,0),this.seekTime=null,this.isLoaded=!1},t.attachHandlers=function(){var e=this;this.worker.addEventListener("message",this.onmessage);var t=d(document).visibilityChange;document.addEventListener(t,this.onvisibilitychange),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline);var n=this.emitter;n.on(x.VOLUME_CHANGED,function(){return e.onVolumeChanged()}),n.on(x.MUTED_CHANGED,function(){return e.onMutedChanged()}),n.on(x.SEEK_COMPLETED,function(){return e.onSeekCompleted()}),n.on(x.ERROR,function(){return e.onError()}),n.on(x.SESSION_DATA,function(t){return e.onSessionData(t)}),n.on(x.SEGMENT_DISCONTINUITY,function(){return e.onSegmentDiscontinuity()}),n.on(th.STATE_CHANGED,function(t){return e.onStateChanged(t)}),n.on(th.MEDIA_SINK_RPC,function(t){return e.mediaSinkManager.applyRPC(t)}),n.on(th.CONFIGURE,function(t){e.mediaSinkManager.configure(t),e.setSinkType(t.mode)}),n.on(th.RESET,function(){var t;null==(t=e.videoTransformerModule)||t.reset(),e.mediaSinkManager.reset()}),n.on(eh.ID3,function(t){return e.onID3(t)}),n.on(th.GET_EXPERIMENTS,function(t){e.experiments=t}),n.on(th.PROPERTY_CHANGED,function(t){var n,r=t.key,i=t.value;e.state[r]=(n=i,"syncTime"===r&&(n*=1e3),n)}),n.on(th.SYNC_TIME_CHANGED,function(t){e.emitter.emit(x.SYNC_TIME_UPDATE,1e3*t)}),n.on(th.BUFFERED_RANGES,function(t){e.state.trackBufferedRanges=t}),n.on(th.LOG_MESSAGE,function(e){var t=e.level;return console[t](e.message)})},t.onVolumeChanged=function(){var e=d(document).hidden;this.pauseHiddenSilentTab&&document[e]&&0===this.getVolume()&&this.postMessage("pause")},t.onMutedChanged=function(){var e=d(document).hidden;this.pauseHiddenSilentTab&&document[e]&&this.isMuted()&&this.postMessage("pause")},t.onSeekCompleted=function(){this.seekTime=null},t.onError=function(){this.paused=!0},t.onStateChanged=function(e){var t,n=this;switch(e){case ep.READY:var r,i,a,o,s=this.isQualitySupported;if(this.adjustments.abrTranscodesOnly&&this.state.qualities.length>1){var u=this.state.qualities.slice().sort(function(e,t){return t.bitrate-e.bitrate});"chunked"!==u[0].group?s=function(e){return"chunked"!==e.group&&n.isQualitySupported(e)}:this.setAutoMaxQuality(u[1])}var c=(r=this.state.qualities,i=s,a=[],o=[],r.forEach(function(e){i(e)?a.push(e):o.push(e)}),{supported:a,unsupported:o});this.state.qualities=c.supported,c.unsupported.forEach(function(e){return n.postMessage("removeQuality",[e])}),this.isLoaded=!0,this.autoPlayOptions&&this.play(),this.paused||this.attemptPlay();break;case ep.IDLE:null==(t=this.videoTransformerModule)||t.stop();break;case ep.PLAYING:this.startVideoTransformer();break;case ep.ENDED:this.paused=!0}this.emitter.emit(x.STATE_CHANGED,e),this.emitter.emit(e)},t.onID3=function(e){var t=this;e.forEach(function(e){if("TXXX"===e.id&&"segmentmetadata"===e.desc&&e.info.length){var n=u(e.info[0]);if(Object.prototype.hasOwnProperty.call(n,"stream_offset")){var r=Number(n.stream_offset);isNaN(r)||(t.state.startOffset=r-t.getPosition())}}})},t.onVisibilityChange=function(){var e=d(document).hidden;this.paused||document[e]||this.attemptPlay(),this.pauseHiddenSilentTab&&!this.paused&&document[e]&&(this.isMuted()||0===this.getVolume())&&this.postMessage("pause"),_().firefox||this.postMessage("setVisible",[!document[e]])},t.onSessionData=function(e){Object.assign(this.state,e)},t.onConfigChanged=function(){var e=this.configManager.getConfigSnapshot(),t=e.features.gpu;t&&(t.flags.enable_render_surface&&(console.log("[MediaPlayerCore]: renderSurface enabled"),this.renderSurface.moveVideoToRenderSurface()),(t.flags.init_transformer||t.flags.run_transformer)&&this.setupVideoTransformer(t)),this.postMessage("updatePlayerConfiguration",[e])},t.setupVideoTransformer=function(e){var t=this;if(!this.videoTransformerModule){var n=function(e){t.renderSurface.setActiveSurface(tR.video),console.warn("VideoTransformer error",e)};this.videoTransformerModule=new t_(e,{error:n,analytics:function(e){t.postMessage(e.name,[e.data])}}),this.videoTransformerModule.init().then(function(n){n&&t.videoTransformerModule?(e.flags.add_canvas_to_surface&&t.renderSurface.setCanvas(n),t.getState()===ep.PLAYING&&t.startVideoTransformer()):console.log("Transformer init failed")}).catch(function(e){var t;console.warn("Unhandled error initializing the Video Transformer",e),n({source:"unknown",code:tE.Init,fatal:!0,message:null!=(t=null==e?void 0:e.message)?t:"error initializing transformer",gpu_architecture:"",gpu_description:"",gpu_device:"",gpu_vendor:""})})}},t.startVideoTransformer=function(){var e=this.configManager.getConfigSnapshot().features.gpu;if(e.flags.run_transformer&&this.videoTransformerModule&&(console.trace("Are we playing?",this.state.state),this.videoTransformerModule.start(this.getHTMLVideoElement()),this.videoTransformerModule.active())){var t,n=tR.video;e.flags.allow_canvas_visible&&(n=tR.canvas,null!=(t=e.render)&&t.debug&&(n=tR.debug_both)),this.renderSurface.setActiveSurface(n)}},t.onWorkerMessage=function(e){var t=e.data;if(t&&t.id===this.id){var n=this.workerMessageProcessors.reduce(function(e,t){return t(e)},t),r=n.type,i=n.arg;void 0!==t.arg?this.emitter.emit(r,i):this.emitter.emit(r)}},t.processVideoElementAttributes=function(e){if(e.hasAttribute("autoplay")&&(e.removeAttribute("autoplay"),this.setAutoplay(!0)),e.hasAttribute("playbackRate")){var t,n=parseFloat(null!=(t=e.getAttribute("playbackRate"))?t:"1.0");if(!isNaN(n)){var r=l(n,.25,2);this.setPlaybackRate(r)}e.removeAttribute("playbackRate")}if(e.hasAttribute("src")){var i=e.src;h(e),this.load(i)}if(e.hasAttribute("loop")&&(e.removeAttribute("loop"),this.setLooping(!0)),e.hasAttribute("muted")&&(e.removeAttribute("muted"),this.setMuted(!0)),e.hasAttribute("volume")){var a,o=parseFloat(null!=(a=e.getAttribute("volume"))?a:"1.0");isNaN(o)||this.setVolume(l(o,0,1)),e.removeAttribute("volume")}},t.checkDebugCaptureEnabled=function(){},e}();tx.instanceId=0;var tV=function(){function e(e){var t=this;this.workerPort=void 0,this.emitter=void 0,this.messageQueue=void 0,this.workerPort={postMessage:this.postMessageFromWorker.bind(this),onmessage:function(){}},this.emitter=new eF.EventEmitter,this.messageQueue=new s,this.loadScript(e,function(e){return t.applyWorkerEnv(e)})}var t=e.prototype;return t.postMessage=function(e){this.messageQueue?this.messageQueue.push(e):this.postMessageToWorker(e)},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.off(e,t)},t.onmessage=function(){},t.onmessageerror=function(){},t.onerror=function(){},t.terminate=function(){},t.dispatchEvent=function(){return!0},t.loadScript=function(e,t){var n=this,r=new XMLHttpRequest;r.open("GET",e),r.addEventListener("load",function(){r.status>=200&&r.status<400?t(r.response):n.emitter.emit("error",Error(r.statusText))}),r.addEventListener("error",function(e){n.emitter.emit("error",e)}),r.send()},t.applyWorkerEnv=function(e){if(this.messageQueue){try{Function("self","messageHandler",e)(window,this.workerPort)}catch(e){return void this.emitter.emit("error",e)}for(;!this.messageQueue.empty();)this.postMessageToWorker(this.messageQueue.pop());this.messageQueue=null}},t.postMessageFromWorker=function(e){var t=this;setTimeout(function(){t.emitter.emit("message",{data:e})},0)},t.postMessageToWorker=function(e){var t=this;setTimeout(function(){t.workerPort.onmessage({data:e})},0)},e}();function tO(e,t,n){var r,i,a;return void 0===n&&(n=!1),_().msIE?r=new tV(e):(i=window.location,(a=document.createElement("a")).href=e,r=new Worker(a.hostname===i.hostname&&a.port===i.port&&a.protocol===i.protocol?e:URL.createObjectURL(new Blob(["importScripts('"+e+"')"])))),r.postMessage({wasmBinaryUrl:t,showWorkerLogs:n}),r}var tN="undefined"!=typeof window&&"object"==typeof window.WebAssembly&&"function"==typeof window.WebAssembly.instantiate,tF=tN;function tU(e){var t=e.asmWorker,n=e.wasmWorker,r=e.wasmBinary;if(!tF&&!t)throw Error("WebAssembly is not supported by the browser. This is required for playback.");var i=tO(tF?n:t,r,e.showWorkerLog);return new t4(e,i)}function tB(){return"1.29.0"}var tH,tG,tW,tj,tq,tK,tQ,tY,tX,tz,tJ,tZ,t$,t0,t1,t2,t3,t4=function(){function e(e,t){this.core=void 0,this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,this.core=new tx(e,t)}var t=e.prototype;return t.addEventListener=function(e,t){var n;null==(n=this.checkCore())||n.addEventListener(e,t)},t.attachHTMLVideoElement=function(e){var t;null==(t=this.checkCore())||t.attachHTMLVideoElement(e)},t.delete=function(){var e;null==(e=this.checkCore())||e.delete(),this.core=null},t.endRemotePlayback=function(){var e;null==(e=this.checkCore())||e.endRemotePlayback()},t.isAutoplay=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoplay()},t.isAutoQualityMode=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoQualityMode()},t.getAverageBitrate=function(){var e;return null==(e=this.checkCore())?void 0:e.getAverageBitrate()},t.getBandwidthEstimate=function(){var e;return null==(e=this.checkCore())?void 0:e.getBandwidthEstimate()},t.getBufferDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferDuration()},t.getBuffered=function(){var e;return null==(e=this.checkCore())?void 0:e.getBuffered()},t.getBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferedRanges()},t.getSinkBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getSinkBufferedRanges()},t.getDecodedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDecodedFrames()},t.getDisplayHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayHeight()},t.getDisplayWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayWidth()},t.getDroppedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDroppedFrames()},t.getDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getDuration()},t.getExperiments=function(){var e;return null==(e=this.checkCore())?void 0:e.getExperiments()},t.getHTMLVideoElement=function(){var e;return null==(e=this.checkCore())?void 0:e.getHTMLVideoElement()},t.getVideoRenderSurface=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoRenderSurface()},t.getLiveLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.getLiveLatency()},t.getPath=function(){var e;return null==(e=this.checkCore())?void 0:e.getPath()},t.getProtocol=function(){var e;return null==(e=this.checkCore())?void 0:e.getProtocol()},t.getPlaybackRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getPlaybackRate()},t.getPosition=function(){var e;return null==(e=this.checkCore())?void 0:e.getPosition()},t.getSyncTime=function(){var e;return null==(e=this.checkCore())?void 0:e.getSyncTime()},t.getQualities=function(){var e;return null==(e=this.checkCore())?void 0:e.getQualities()},t.getQuality=function(){var e;return null==(e=this.checkCore())?void 0:e.getQuality()},t.getSessionData=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionData()},t.getSessionId=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionId()},t.getChannelMetadata=function(){var e,t;return null!=(e=null==(t=this.checkCore())?void 0:t.getChannelMetadata())?e:[]},t.getStartOffset=function(){var e;return null==(e=this.checkCore())?void 0:e.getStartOffset()},t.getState=function(){var e;return null==(e=this.checkCore())?void 0:e.getState()},t.getVersion=function(){var e;return null==(e=this.checkCore())?void 0:e.getVersion()},t.getVideoBitRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoBitRate()},t.getVideoFrameRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoFrameRate()},t.getVideoHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoHeight()},t.getVideoWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoWidth()},t.getVolume=function(){var e;return null==(e=this.checkCore())?void 0:e.getVolume()},t.isLiveLowLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.isLiveLowLatency()},t.isLooping=function(){var e;return null==(e=this.checkCore())?void 0:e.isLooping()},t.isMuted=function(){var e;return null==(e=this.checkCore())?void 0:e.isMuted()},t.isPaused=function(){var e;return null==(e=this.checkCore())?void 0:e.isPaused()},t.isProtected=function(){var e;return null==(e=this.checkCore())?void 0:e.isProtected()},t.isSeeking=function(){var e;return null==(e=this.checkCore())?void 0:e.isSeeking()},t.load=function(e,t){var n;return void 0===t&&(t=""),null==(n=this.checkCore())?void 0:n.load(e,t)},t.pause=function(){var e;null==(e=this.checkCore())||e.pause()},t.play=function(){var e;null==(e=this.checkCore())||e.play()},t.removeEventListener=function(e,t){var n;null==(n=this.checkCore())||n.removeEventListener(e,t)},t.seekTo=function(e){var t;null==(t=this.checkCore())||t.seekTo(e)},t.setAuthToken=function(e){var t;null==(t=this.checkCore())||t.setAuthToken(e)},t.setAutoInitialBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoInitialBitrate(e)},t.setAutoMaxQuality=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxQuality(e)},t.setAutoMaxBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxBitrate(e)},t.setAutoMaxVideoSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoMaxVideoSize(e,t)},t.setAutoplay=function(e){var t;null==(t=this.checkCore())||t.setAutoplay(e)},t.setAutoPlayOptions=function(e){var t;null==(t=this.checkCore())||t.setAutoPlayOptions(e)},t.setAutoQualityMode=function(e){var t;null==(t=this.checkCore())||t.setAutoQualityMode(e)},t.setAutoViewportSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoViewportSize(e,t)},t.setClientId=function(e){var t;null==(t=this.checkCore())||t.setClientId(e)},t.setDeviceId=function(e){var t;null==(t=this.checkCore())||t.setDeviceId(e)},t.setExperiment=function(e,t){var n;null==(n=this.checkCore())||n.setExperiment(e,t)},t.setExperimentData=function(e){var t;null==(t=this.checkCore())||t.setExperimentData(e)},t.setInitialBufferDuration=function(e){var t;null==(t=this.checkCore())||t.setInitialBufferDuration(e)},t.setLiveLowLatencyEnabled=function(e){var t;null==(t=this.checkCore())||t.setLiveLowLatencyEnabled(e)},t.setLiveMaxLatency=function(e){var t;null==(t=this.checkCore())||t.setLiveMaxLatency(e)},t.setLiveSpeedUpRate=function(e){var t;null==(t=this.checkCore())||t.setLiveSpeedUpRate(e)},t.setLogLevel=function(e){var t;null==(t=this.checkCore())||t.setLogLevel(e)},t.setLooping=function(e){var t;null==(t=this.checkCore())||t.setLooping(e)},t.setMuted=function(e){var t;null==(t=this.checkCore())||t.setMuted(e)},t.setPlaybackRate=function(e){var t;null==(t=this.checkCore())||t.setPlaybackRate(e)},t.setPlayerType=function(e){var t;null==(t=this.checkCore())||t.setPlayerType(e)},t.setQuality=function(e,t){var n;void 0===t&&(t=!1),null==(n=this.checkCore())||n.setQuality(e,t)},t.setRebufferToLive=function(e){var t;null==(t=this.checkCore())||t.setRebufferToLive(e)},t.setVisible=function(e){var t;null==(t=this.checkCore())||t.setVisible(e)},t.setVolume=function(e){var t;null==(t=this.checkCore())||t.setVolume(e)},t.startRemotePlayback=function(){var e;null==(e=this.checkCore())||e.startRemotePlayback()},t.setPlatformName=function(e){var t;null==(t=this.checkCore())||t.setPlatformName(e)},t.setRequestCredentials=function(e){var t;null==(t=this.checkCore())||t.setRequestCredentials(e)},t.checkCore=function(){return this.core||console.warn("Method called on deleted player instance."),this.core},e}(),t8=((tz={}).UNKNOWN="Unspecified",tz.FILE="File",tz.SEGMENT="Segment",tz.SOURCE="Source",tz.DECODER="Decode",tz.RENDERER="Render",tz.MASTER_PLAYLIST="MasterPlaylist",tz.MEDIA_PLAYLIST="MediaPlaylist",tz.DRM="DRM",tz),t6=((tJ={}).GENERIC="Error",tJ.NOT_SUPPORTED="ErrorNotSupported",tJ.NO_SOURCE="ErrorNoSource",tJ.INVALID_DATA="ErrorInvalidData",tJ.INVALID_STATE="ErrorInvalidState",tJ.INVALID_PARAMETER="ErrorInvalidParameter",tJ.TIMEOUT="ErrorTimeout",tJ.NETWORK="ErrorNetwork",tJ.NETWORK_IO="ErrorNetworkIO",tJ.AUTHORIZATION="ErrorAuthorization",tJ.NOT_AVAILABLE="ErrorNotAvailable",tJ),t5=((tZ={})[tZ.GEOBLOCKED=1]="GEOBLOCKED",tZ[tZ.UNSUPPORTED_DEVICE=2]="UNSUPPORTED_DEVICE",tZ[tZ.ANONYMIZER_BLOCKED=3]="ANONYMIZER_BLOCKED",tZ[tZ.CELLULAR_NETWORK_PROHIBITED=4]="CELLULAR_NETWORK_PROHIBITED",tZ[tZ.UNAUTHORIZATION_ENTITLEMENTS=5]="UNAUTHORIZATION_ENTITLEMENTS",tZ[tZ.VOD_RESTRICTED=6]="VOD_RESTRICTED",tZ),t9=((t$={}).CAPTURE_ENABLED="CaptureEnabled",t$.CAPTURE_BUNDLE="CaptureBundle",t$.CAPTURE_ANALYTICS="CaptureAnalytics",t$.FMP4_SEGMENT="FMP4Segment",t$),t7=((t0={}).DEBUG="debug",t0.INFO="info",t0.WARN="warn",t0.ERROR="error",t0),ne=((t1={}).DURATION_CHANGE="durationchange",t1.ENDED="ended",t1.ERROR="error",t1.LOADED_METADATA="loadedmetadata",t1.LOADSTART="loadstart",t1.PAUSE="pause",t1.PLAY="play",t1.PLAYING="playing",t1.RATE_CHANGE="ratechange",t1.SEEKED="seeked",t1.SEEKING="seeking",t1.TIME_UPDATE="timeupdate",t1.VOLUME_CHANGE="volumechange",t1.WAITING="waiting",t1),nt=((t2=nt||{})[t2.HAVE_NOTHING=0]="HAVE_NOTHING",t2[t2.HAVE_METADATA=1]="HAVE_METADATA",t2[t2.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t2[t2.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t2[t2.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA",t2),nn=((t3={})[ep.IDLE]=1,t3[ep.READY]=1,t3[ep.BUFFERING]=2,t3[ep.PLAYING]=2,t3[ep.ENDED]=1,t3),nr="AmazonIVS";function ni(e,t){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, AmazonIVS tech not registered",code:1};if(!tF)throw{message:"WebAssembly support is required for AmazonIVS tech",code:2};if(!e.getTech(nr)){var n,r={featuresProgressEvents:!0,featuresTimeupdateEvents:!0,featuresPlaybackRate:!0,featuresFullscreenResize:!0,featuresVolumeControl:!0,featuresMuteControl:!0,featuresNativeTextTracks:!1,privateContructor:function(n,r,i){this._readyState=nt.HAVE_NOTHING,this._defaultPlaybackRate=1,this._seeking=!1,t.playerFramework={name:"videojs",version:e.VERSION},this._mediaPlayer=tU(t),this._mediaPlayer.setAutoplay(!0===n.autoplay),this._attachVideojsListeners(),this._mediaPlayer.addEventListener(x.METADATA,this._onCaptionEvent.bind(this));var a=this._createEl(n);n.el=a,i(this,n,r),window.vttjs&&window.vttjs.restore(),this.triggerReady(),setTimeout((function(){var e=this.options(),t=e.loop,n=e.muted;t&&this._mediaPlayer.setLooping(!0),n&&this._mediaPlayer.setMuted(!0)}).bind(this),0)},dispose:function(){this._mediaPlayer.delete()},setPreload:function(){},autoplay:function(e){if("boolean"!=typeof e)return this._mediaPlayer.autoplay;this.setAutoplay(e)},setAutoplay:function(e){this._mediaPlayer.setAutoplay(e)},preload:function(){},load:function(){},readyState:function(){return this._readyState},seeking:function(){return this._seeking},networkState:function(){return this._mediaPlayer?this._mediaPlayer.getHTMLVideoElement().src?nn[this._mediaPlayer.getState()]:3:0},ended:function(){return this._mediaPlayer.getState()===ep.ENDED},seekable:function(){return e.createTimeRange(0,this._mediaPlayer.getDuration())},play:function(){this._mediaPlayer.play(),this.trigger(ne.PLAY)},pause:function(){this._mediaPlayer.pause()},setCurrentTime:function(e){this._mediaPlayer.getHTMLVideoElement().src&&(this._mediaPlayer.seekTo(e),this._seeking=!0,this.trigger(ne.SEEKING))},controls:function(){return!1},setControls:function(){return!1},muted:function(){return this._mediaPlayer.isMuted()},setMuted:function(e){this._mediaPlayer.setMuted(e)},volume:function(){return this._mediaPlayer.getVolume()},setVolume:function(e){this._mediaPlayer.setVolume(e)},defaultPlaybackRate:function(e){if(!e)return this._defaultPlaybackRate;this._defaultPlaybackRate=e},playbackRate:function(){return this._mediaPlayer.getPlaybackRate()},setPlaybackRate:function(e){this._mediaPlayer.setPlaybackRate(e)},paused:function(){return this._mediaPlayer.isPaused()},duration:function(){return this._mediaPlayer.getDuration()},currentTime:function(){return this._mediaPlayer.getPosition()},_createEl:function(e){var t=this._mediaPlayer.getHTMLVideoElement();t.setAttribute("class","vjs-tech"),void 0!==e.disablePictureInPicture&&(t.disablePictureInPicture=e.disablePictureInPicture),["preload","poster"].forEach((function(n){e[n]&&t.setAttribute(n,e[n])}).bind(this)),e.playsinline&&(t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""));var n=document.createElement("div");return n.appendChild(t),n},src:function(e){this.trigger(ne.LOADSTART),this._seeking=!1,this._captionTrack&&(this.textTracks().removeTrack(this._captionTrack),this._captionTrack=null),e&&this._mediaPlayer.load(e)},addEventListener:function(e,t){this._mediaPlayer.addEventListener(e,t)},removeEventListener:function(e,t){this._mediaPlayer.removeEventListener(e,t)},getMediaPlayerAPI:function(){return this._mediaPlayer},supportsFullScreen:function(){return!0},enterFullScreen:function(){var e=this._mediaPlayer.getHTMLVideoElement();(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitEnterFullscreen||function(){console.error("Fullscreen API is not available")}).call(e)},exitFullScreen:function(){(document.exitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){console.error("Exitscreen API is not available")}).call(document)},requestPictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().requestPictureInPicture()},setDisablePictureInPicture:function(e){this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture=e},disablePictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture},_onCaptionEvent:function(e){if("text/json"===e.type){var t=JSON.parse(e.data);if(t.caption){var n=t.caption;this._captionTrack||(this._captionTrack=this.addTextTrack("captions",n.format),this._currentCue=null),this._currentCue&&this._captionTrack.removeCue(this._currentCue);var r=this._mediaPlayer.getHTMLVideoElement(),i=window.VTTCue||window.vttjs.VTTCue;i?(this._currentCue=new i(r.currentTime,r.currentTime+2,n.text),this._captionTrack.addCue(this._currentCue)):console.warn("No VTTCue implementation available, caption may not be available")}}},_attachVideojsListeners:function(){this._mediaPlayer.addEventListener(ep.READY,(function(){this._readyState=nt.HAVE_METADATA,this.trigger(ne.LOADED_METADATA)}).bind(this)),this._mediaPlayer.addEventListener(ep.IDLE,(function(){this._readyState=nt.HAVE_NOTHING,this.trigger(ne.PAUSE)}).bind(this)),this._mediaPlayer.addEventListener(ep.PLAYING,(function(){this._readyState<=nt.HAVE_CURRENT_DATA&&(this._readyState=nt.HAVE_FUTURE_DATA),this.trigger(ne.PLAY),this.trigger(ne.PLAYING)}).bind(this)),this._mediaPlayer.addEventListener(ep.ENDED,(function(){this._readyState=nt.HAVE_NOTHING,this.trigger(ne.ENDED)}).bind(this)),this._mediaPlayer.addEventListener(ep.BUFFERING,(function(){this._readyState=nt.HAVE_CURRENT_DATA}).bind(this)),this._mediaPlayer.addEventListener(x.REBUFFERING,(function(){this._readyState=nt.HAVE_CURRENT_DATA,this.trigger(ne.WAITING)}).bind(this)),this._mediaPlayer.addEventListener(x.TIME_UPDATE,(function(){this.trigger(ne.TIME_UPDATE)}).bind(this)),this._mediaPlayer.addEventListener(x.VOLUME_CHANGED,(function(){this.trigger(ne.VOLUME_CHANGE)}).bind(this)),this._mediaPlayer.addEventListener(x.MUTED_CHANGED,(function(){this.trigger(ne.VOLUME_CHANGE)}).bind(this)),this._mediaPlayer.addEventListener(x.ERROR,(function(){this.trigger(ne.ERROR)}).bind(this)),this._mediaPlayer.addEventListener(x.DURATION_CHANGED,(function(){this.trigger(ne.DURATION_CHANGE)}).bind(this)),this._mediaPlayer.addEventListener(x.SEEK_COMPLETED,(function(){this._seeking=!1,this.trigger(ne.SEEKED)}).bind(this)),this._mediaPlayer.addEventListener(x.PLAYBACK_RATE_CHANGED,(function(){this.trigger(ne.RATE_CHANGE)}).bind(this))}},i=e.getTech("Tech");"function"==typeof e.extend?(r.constructor=function(e,t){this.privateContructor(e,t,function(e,t,n){i.call(e,t,n)})},n=e.extend(i,r,nr)):((n=function(e,t){this.privateContructor(e,t,function(e,t,n){var r=i.prototype,a=r.featuresProgressEvents,o=r.featuresTimeupdateEvents,s=r.featuresPlaybackRate,u=r.featuresFullscreenResize,c=r.featuresVolumeControl,d=r.featuresMuteControl,l=r.featuresNativeTextTracks;r.featuresProgressEvents=!0,r.featuresTimeupdateEvents=!0,r.featuresPlaybackRate=!0,r.featuresFullscreenResize=!0,r.featuresVolumeControl=!0,r.featuresMuteControl=!0,r.featuresNativeTextTracks=!1,Object.assign(e,new i(t,n)),e.on(ne.PLAYING,function(){e.hasStarted_=!0}),e.on(ne.LOADSTART,function(){e.hasStarted_=!1}),r.featuresProgressEvents=a,r.featuresTimeupdateEvents=o,r.featuresPlaybackRate=s,r.featuresFullscreenResize=u,r.featuresVolumeControl=c,r.featuresMuteControl=d,r.featuresNativeTextTracks=l})}).prototype=Object.create(i.prototype),Object.assign(n.prototype,r)),n.supportsFullScreen=function(){return!0},n.isSupported=function(){return -1===(navigator.appVersion||"").toLowerCase().indexOf("rv:11")},n.canPlayType=function(e){return"string"==typeof e&&e.length>0&&(e.indexOf("application/x-mpegURL")>-1?"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'):""!==document.createElement("video").canPlayType(e))},n.canPlaySource=function(){return!0},e.registerTech("AmazonIVS",n);var a=e.registerPlugin||e.plugin;a("getIVSEvents",function(){return{PlayerEventType:x,MetadataEventType:eh,PlayerState:ep,ErrorType:t6}}),a("getIVSPlayer",function(){return this.tech(!0).getMediaPlayerAPI()})}}var na="enableIVSQualityPlugin";function no(e){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, Amazon IVS Quality Plugin not registered",code:1};if(!e.getPlugin(na)){var t,n=e.getComponent("MenuButton"),r=e.getComponent("MenuItem"),i={privateConstructor:function(e,t,n){n(this,e,t),this.controlText("Quality")},createItems:function(){var e=this.player(),t=e.getIVSPlayer(),n=[],i=new r(e,{selectable:!0,label:"Auto",qualityGroup:"auto"});i.selected(t.isAutoQualityMode()),i.on(["click","tap"],function(){t.setAutoQualityMode(!0)}),i.on(["click","tap"],this._clickHandler.bind(this,i)),n.push(i);var a=t.getQuality(),o=t.getQualities();return o&&o.length>0&&o.forEach((function(i){var o=new r(e,{selectable:!0,label:i.name,qualityGroup:i.group}),s=(function(e){t.setQuality(e)}).bind(null,i);o.on(["click","tap"],s),o.on(["click","tap"],this._clickHandler.bind(this,o)),t.isAutoQualityMode()||o.selected(a.group===i.group),n.push(o)}).bind(this)),t.addEventListener(x.QUALITY_CHANGED,function(n){var r;if(!t.isAutoQualityMode()){var i=null==(r=e.controlBar)?void 0:r.getChild("QualityMenuButton");null==i||i.items.forEach(function(e){var t=e.options().qualityGroup;n&&t&&e.selected(n.group===t)})}}),this.qualityItems=n,n},buildCSSClass:function(){return"vjs-icon-hd vjs-icon-placeholder "+n.prototype.buildCSSClass.call(this)},_clickHandler:function(e){this.items.forEach(function(t){t!==e&&t.selected(!1)})}};"function"==typeof e.extend?(i.constructor=function(e,t){this.privateConstructor(e,t,function(e,t,r){n.call(e,t,r)})},t=e.extend(n,i)):((t=function(e,t){this.privateConstructor(e,t,function(e,t,r){var i="quality-control";r.name=i;var a=new n(t,r);a.getChild(i).addClass("vjs-icon-hd vjs-icon-placeholder"),Object.assign(e,a),e.items=e.createItems(),e.items.forEach(function(t){e.menu.addItem(t)})})}).prototype=Object.create(n.prototype),Object.assign(t.prototype,i)),e.registerComponent("QualityMenuButton",t),(e.registerPlugin||e.plugin)(na,function(){var e=this;e.getIVSPlayer().addEventListener(ep.READY,function(){var t,n,r=null==(t=e.controlBar)?void 0:t.getChild("QualityMenuButton");r&&(r.dispose(),e.controlBar.removeChild(r)),null==(n=e.controlBar)||n.addChild("QualityMenuButton")})})}}e.exports=r}()}}]);